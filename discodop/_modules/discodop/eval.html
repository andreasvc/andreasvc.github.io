<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>discodop.eval &mdash; Disco-DOP 0.5pre1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.5pre1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Disco-DOP 0.5pre1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../index.html">Disco-DOP 0.5pre1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for discodop.eval</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Evaluation of (discontinuous) parse trees.</span>

<span class="sd">Follows EVALB as much as possible, and provides some alternative evaluation</span>
<span class="sd">metrics.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span><span class="p">,</span> \
		<span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">getopt</span> <span class="kn">import</span> <span class="n">gnu_getopt</span><span class="p">,</span> <span class="n">GetoptError</span>
<span class="kn">from</span> <span class="nn">decimal</span> <span class="kn">import</span> <span class="n">Decimal</span><span class="p">,</span> <span class="n">InvalidOperation</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">count</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span><span class="p">,</span> <span class="n">Counter</span>  <span class="c"># == multiset</span>
<span class="k">if</span> <span class="n">sys</span><span class="o">.</span><span class="n">version</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="s">&#39;3&#39;</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">zip_longest</span>  <span class="c"># pylint: disable=E0611</span>
<span class="k">else</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">izip_longest</span> <span class="k">as</span> <span class="n">zip_longest</span>  <span class="c"># pylint: disable=E0611</span>

<span class="kn">from</span> <span class="nn">discodop</span> <span class="kn">import</span> <span class="n">grammar</span>
<span class="kn">from</span> <span class="nn">discodop.tree</span> <span class="kn">import</span> <span class="n">Tree</span>
<span class="kn">from</span> <span class="nn">discodop.treedraw</span> <span class="kn">import</span> <span class="n">DrawTree</span>
<span class="kn">from</span> <span class="nn">discodop.treebank</span> <span class="kn">import</span> <span class="n">READERS</span><span class="p">,</span> <span class="n">dependencies</span><span class="p">,</span> <span class="n">handlefunctions</span>
<span class="kn">from</span> <span class="nn">discodop.treetransforms</span> <span class="kn">import</span> <span class="n">disc</span><span class="p">,</span> <span class="n">getbits</span><span class="p">,</span> <span class="n">bitfanout</span>
<span class="kn">from</span> <span class="nn">discodop.treebanktransforms</span> <span class="kn">import</span> <span class="n">functions</span>
<span class="k">try</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">discodop.treedist</span> <span class="kn">import</span> <span class="n">treedist</span><span class="p">,</span> <span class="n">newtreedist</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">discodop.treedist</span> <span class="kn">import</span> <span class="n">newtreedist</span> <span class="k">as</span> <span class="n">newtreedist</span><span class="p">,</span> <span class="n">newtreedist</span>

<span class="n">SHORTUSAGE</span> <span class="o">=</span> <span class="s">&#39;Usage: </span><span class="si">%s</span><span class="s"> &lt;gold&gt; &lt;parses&gt; [param] [options]&#39;</span> <span class="o">%</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">USAGE</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span><span class="se">\</span>
<span class="s">Evaluation of (discontinuous) parse trees, following EVALB as much as possible.</span>

<span class="si">%s</span><span class="s"></span>
<span class="s">where gold and parses are files with parse trees, param is an EVALB parameter</span>
<span class="s">file, and options may consist of:</span>

<span class="s">  --cutofflen=n    Overrides the sentence length cutoff of the parameter file.</span>
<span class="s">  --verbose        Print table with per sentence information.</span>
<span class="s">  --debug          Print debug information with per sentence bracketings etc.</span>
<span class="s">  --disconly       Only evaluate discontinuous bracketings (affects bracketing</span>
<span class="s">                   scores: precision, recall, f-measure, exact match).</span>
<span class="s">  --goldfmt|--parsesfmt=(</span><span class="si">%s</span><span class="s">)</span>
<span class="s">                   Specify corpus format [default: export].</span>
<span class="s">  --fmt=(...)      Shorthand for setting both --goldfmt and --parsesfmt.</span>
<span class="s">  --goldenc|--parsesenc=(utf-8|iso-8859-1|...)</span>
<span class="s">                   Specify encoding [default: utf-8].</span>
<span class="s">  --la             Enable leaf-ancestor evaluation.</span>
<span class="s">  --ted            Enable tree-edit distance evaluation.</span>
<span class="s">  --headrules=x    Specify file with rules for head assignment of constituents</span>
<span class="s">                   that do not already have a child marked as head; this</span>
<span class="s">                   enables dependency evaluation.</span>
<span class="s">  --functions=x    &#39;remove&#39;=default: strip functions off labels,</span>
<span class="s">                   &#39;leave&#39;: leave syntactic labels as is,</span>
<span class="s">                   &#39;add&#39;: evaluate both syntactic categories and functions,</span>
<span class="s">                   &#39;replace&#39;: only evaluate function tags.</span>
<span class="s">  --morphology=x   &#39;no&#39;=default: only evaluate POS tags,</span>
<span class="s">                   &#39;add&#39;: concatenate morphology tags to POS tags,</span>
<span class="s">                   &#39;replace&#39;: replace POS tags with morphology tags,</span>
<span class="s">                   &#39;between&#39;: add morphological node between POS tag and word.</span>

<span class="s">The parameter file should be encoded in UTF-8 and supports the following</span>
<span class="s">options (in addition to those described in the README of EVALB):</span>
<span class="s">  DELETE_ROOT_PRETERMS</span>
<span class="s">                   if nonzero, ignore preterminals directly under the root in</span>
<span class="s">                   gold trees for scoring purposes.</span>
<span class="s">  DISC_ONLY        if nonzero, only consider discontinuous bracketings</span>
<span class="s">                   (affects precision, recall, f-measure, exact match).</span>
<span class="s">  LA               if nonzero, report leaf-ancestor scores [default: disabled].</span>
<span class="s">  TED              if nonzero, report tree-edit distance scores; disabled by</span>
<span class="s">                   default as these are slow to compute.</span>
<span class="s">  DEBUG            -1 only print summary table</span>
<span class="s">                   0 additionally, print category / tag breakdowns (default)</span>
<span class="s">                     (after application of cutoff length).</span>
<span class="s">                   1 give per-sentence results (&#39;--verbose&#39;)</span>
<span class="s">                   2 give detailed information for each sentence (&#39;--debug&#39;)</span>
<span class="s">  MAX_ERROR        this value is ignored, no errors are tolerated.</span>
<span class="s">                   the parameter is accepted to support usage of unmodified</span>
<span class="s">                   EVALB parameter files. &#39;&#39;&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">SHORTUSAGE</span><span class="p">,</span> <span class="s">&#39;|&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">READERS</span><span class="p">))</span>

<span class="n">HEADER</span> <span class="o">=</span> <span class="s">&#39;&#39;&#39;</span>
<span class="s">   Sentence                 Matched   Brackets            Corr   POS</span>
<span class="s">  ID Length  Recall  Precis Bracket   gold   cand  Words  POS  Accur.</span><span class="se">\</span>
<span class="s">&#39;&#39;&#39;</span><span class="o">.</span><span class="n">splitlines</span><span class="p">()</span>


<div class="viewcode-block" id="Evaluator"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.Evaluator">[docs]</a><span class="k">class</span> <span class="nc">Evaluator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Incremental evaluator for syntactic trees.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">keylen</span><span class="o">=</span><span class="mi">8</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Initialize evaluator object with given parameters.</span>

<span class="sd">		:param param: a dictionary of parameters, as read by ``readparam``.</span>
<span class="sd">		:param keylen: the length of the longest sentence ID, for padding</span>
<span class="sd">			purposes.&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">param</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">keylen</span> <span class="o">=</span> <span class="n">keylen</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">acc</span> <span class="o">=</span> <span class="n">EvalAccumulator</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DISC_ONLY&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">acc40</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;CUTOFF_LEN&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">acc40</span> <span class="o">=</span> <span class="n">EvalAccumulator</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DISC_ONLY&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;Parameters:&#39;</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">param</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="n">a</span><span class="p">]))</span>
			<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">HEADER</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keylen</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">keylen</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">HEADER</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>

<div class="viewcode-block" id="Evaluator.add"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.Evaluator.add">[docs]</a>	<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">gtree</span><span class="p">,</span> <span class="n">gsent</span><span class="p">,</span> <span class="n">ctree</span><span class="p">,</span> <span class="n">csent</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Add a pair of gold and candidate trees to the evaluation.</span>

<span class="sd">		:param n: a unique identifier for this sentence.</span>
<span class="sd">		:param gtree, ctree: ParentedTree objects (will be modified in-place)</span>
<span class="sd">		:param gsent, csent: lists of tokens.</span>
<span class="sd">		:returns: a ``TreePairResult`` object.&quot;&quot;&quot;</span>
		<span class="n">treepair</span> <span class="o">=</span> <span class="n">TreePairResult</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">gtree</span><span class="p">,</span> <span class="n">gsent</span><span class="p">,</span> <span class="n">ctree</span><span class="p">,</span> <span class="n">csent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">treepair</span><span class="p">)</span>
		<span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;CUTOFF_LEN&#39;</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span>
				<span class="ow">and</span> <span class="n">treepair</span><span class="o">.</span><span class="n">lengpos</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;CUTOFF_LEN&#39;</span><span class="p">]):</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">acc40</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">treepair</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">treepair</span><span class="o">.</span><span class="n">debug</span><span class="p">()</span>
			<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">HEADER</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">keylen</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span><span class="p">)</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span> <span class="o">*</span> <span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">keylen</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">+</span> <span class="nb">len</span><span class="p">(</span><span class="n">HEADER</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">treepair</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%%%d</span><span class="s">s  &#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">keylen</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">treepair</span>
</div>
<div class="viewcode-block" id="Evaluator.breakdowns"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.Evaluator.breakdowns">[docs]</a>	<span class="k">def</span> <span class="nf">breakdowns</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Print breakdowns for the most frequent rules, labels, tags.&quot;&quot;&quot;</span>
		<span class="n">limit</span> <span class="o">=</span> <span class="mi">10</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">rulebreakdowns</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">catbreakdown</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="o">.</span><span class="n">candfun</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">funcbreakdown</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="o">.</span><span class="n">goldpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span><span class="o">.</span><span class="n">candpos</span><span class="p">)</span>
		<span class="k">except</span> <span class="n">InvalidOperation</span><span class="p">:</span>
			<span class="k">pass</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">acc</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">tagbreakdown</span><span class="p">(</span><span class="n">limit</span><span class="p">)</span>
		<span class="k">print</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Evaluator.rulebreakdowns"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.Evaluator.rulebreakdowns">[docs]</a>	<span class="k">def</span> <span class="nf">rulebreakdowns</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Print breakdowns for the most frequent rule mismatches.&quot;&quot;&quot;</span>
		<span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span>
		<span class="c"># NB: unary nodes not handled properly</span>
		<span class="n">gmismatch</span> <span class="o">=</span> <span class="p">{(</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span> <span class="n">rule</span>
					<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldrule</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">candrule</span><span class="p">}</span>
		<span class="n">wrong</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">((</span><span class="n">rule</span><span class="p">,</span> <span class="n">gmismatch</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">])</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">rule</span>
				<span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">candrule</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldrule</span>
				<span class="k">if</span> <span class="n">pyintbitcount</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gmismatch</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Rewrite rule mismatches (for given span)&#39;</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;   count   cand / gold rules&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">crule</span><span class="p">,</span> <span class="n">grule</span><span class="p">),</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">wrong</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39; </span><span class="si">%7d</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">grammar</span><span class="o">.</span><span class="n">printrule</span><span class="p">(</span><span class="o">*</span><span class="n">crule</span><span class="p">)))</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39; </span><span class="si">%7s</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">grammar</span><span class="o">.</span><span class="n">printrule</span><span class="p">(</span><span class="o">*</span><span class="n">grule</span><span class="p">)))</span>
		<span class="n">gspans</span> <span class="o">=</span> <span class="p">{(</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldrule</span><span class="p">}</span>
		<span class="n">wrong</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">rule</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">rule</span>
				<span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">candrule</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldrule</span>
				<span class="k">if</span> <span class="n">pyintbitcount</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">gspans</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Rewrite rules (span not in gold trees)&#39;</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;   count   rule in candidate parses&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">crule</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">wrong</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39; </span><span class="si">%7d</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">grammar</span><span class="o">.</span><span class="n">printrule</span><span class="p">(</span><span class="o">*</span><span class="n">crule</span><span class="p">)))</span>
		<span class="n">cspans</span> <span class="o">=</span> <span class="p">{(</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">candrule</span><span class="p">}</span>
		<span class="n">wrong</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">rule</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">rule</span>
				<span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldrule</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">candrule</span>
				<span class="k">if</span> <span class="n">pyintbitcount</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">cspans</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Rewrite rules (span missing from candidate parses)&#39;</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;   count   rule in gold standard set&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">grule</span><span class="p">,</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">wrong</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39; </span><span class="si">%7d</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cnt</span><span class="p">,</span> <span class="n">grammar</span><span class="o">.</span><span class="n">printrule</span><span class="p">(</span><span class="o">*</span><span class="n">grule</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="Evaluator.catbreakdown"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.Evaluator.catbreakdown">[docs]</a>	<span class="k">def</span> <span class="nf">catbreakdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Print breakdowns for the most frequent labels.&quot;&quot;&quot;</span>
		<span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Attachment errors (correct labeled bracketing, wrong parent)&#39;</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;  label     cand     gold    count&#39;</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="mi">33</span> <span class="o">*</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
		<span class="n">gmismatch</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldbatt</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">candbatt</span><span class="p">)</span>
		<span class="n">wrong</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">((</span><span class="n">label</span><span class="p">,</span> <span class="n">cparent</span><span class="p">,</span> <span class="n">gmismatch</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">indices</span><span class="p">])</span>
					<span class="k">for</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">indices</span><span class="p">),</span> <span class="n">cparent</span>
					<span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">candbatt</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldbatt</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gmismatch</span><span class="p">)</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">cat</span><span class="p">,</span> <span class="n">gparent</span><span class="p">,</span> <span class="n">cparent</span><span class="p">),</span> <span class="n">cnt</span> <span class="ow">in</span> <span class="n">wrong</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">limit</span><span class="p">):</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s">  </span><span class="si">%7d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">cat</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="n">gparent</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
					<span class="n">cparent</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span> <span class="n">cnt</span><span class="p">))</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Category Statistics (</span><span class="si">%s</span><span class="s"> categories / errors)&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> most frequent&#39;</span> <span class="o">%</span> <span class="n">limit</span><span class="p">)</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="s">&#39;all&#39;</span><span class="p">))</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;  label  </span><span class="si">% g</span><span class="s">old  recall    prec.     F1&#39;</span><span class="p">,</span>
				<span class="s">&#39;          cand gold       count&#39;</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="mi">38</span> <span class="o">*</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="mi">24</span> <span class="o">*</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
		<span class="n">gmismatch</span> <span class="o">=</span> <span class="p">{(</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">):</span> <span class="n">label</span>
					<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldb</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="p">}</span>
		<span class="n">wrong</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">((</span><span class="n">label</span><span class="p">,</span> <span class="n">gmismatch</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">])</span>
					<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">candb</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldb</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gmismatch</span><span class="p">)</span>
		<span class="n">freqcats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldbcat</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">candbcat</span><span class="p">),</span>
				<span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldbcat</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">mismatch</span> <span class="ow">in</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">freqcats</span><span class="p">[:</span><span class="n">limit</span><span class="p">],</span>
				<span class="n">wrong</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">limit</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">cat</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="mi">39</span> <span class="o">*</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">  </span><span class="si">%6.2f</span><span class="s">  </span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">cat</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
					<span class="mi">100</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldbcat</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="p">),</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">recall</span><span class="p">(</span>
							<span class="n">acc</span><span class="o">.</span><span class="n">goldbcat</span><span class="p">[</span><span class="n">cat</span><span class="p">],</span> <span class="n">acc</span><span class="o">.</span><span class="n">candbcat</span><span class="p">[</span><span class="n">cat</span><span class="p">])),</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">precision</span><span class="p">(</span>
							<span class="n">acc</span><span class="o">.</span><span class="n">goldbcat</span><span class="p">[</span><span class="n">cat</span><span class="p">],</span> <span class="n">acc</span><span class="o">.</span><span class="n">candbcat</span><span class="p">[</span><span class="n">cat</span><span class="p">])),</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span>
							<span class="n">acc</span><span class="o">.</span><span class="n">goldbcat</span><span class="p">[</span><span class="n">cat</span><span class="p">],</span> <span class="n">acc</span><span class="o">.</span><span class="n">candbcat</span><span class="p">[</span><span class="n">cat</span><span class="p">])),</span>
					<span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">mismatch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39;       </span><span class="si">%s</span><span class="s"> </span><span class="si">%7d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">mismatch</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
						<span class="n">mismatch</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">))),</span> <span class="n">mismatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
			<span class="k">print</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Evaluator.funcbreakdown"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.Evaluator.funcbreakdown">[docs]</a>	<span class="k">def</span> <span class="nf">funcbreakdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Print breakdowns for the most frequent function tags.&quot;&quot;&quot;</span>
		<span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> Function Tag Statistics (</span><span class="si">%s</span><span class="s"> tags / errors)&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> most frequent&#39;</span> <span class="o">%</span> <span class="n">limit</span><span class="p">)</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="s">&#39;all&#39;</span><span class="p">))</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;  func.  </span><span class="si">% g</span><span class="s">old  recall    prec.     F1&#39;</span><span class="p">,</span>
				<span class="s">&#39;          cand gold       count&#39;</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="mi">38</span> <span class="o">*</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="mi">24</span> <span class="o">*</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
		<span class="n">gmismatch</span> <span class="o">=</span> <span class="p">{(</span><span class="n">n</span><span class="p">,</span> <span class="n">span</span><span class="p">):</span> <span class="n">tag</span>
					<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldfun</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">candfun</span><span class="p">}</span>
		<span class="n">wrong</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">((</span><span class="n">tag</span><span class="p">,</span> <span class="n">gmismatch</span><span class="p">[</span><span class="n">n</span><span class="p">,</span> <span class="n">span</span><span class="p">])</span>
					<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="p">(</span><span class="n">span</span><span class="p">,</span> <span class="n">tag</span><span class="p">)</span> <span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">candfun</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldfun</span>
					<span class="k">if</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">span</span><span class="p">)</span> <span class="ow">in</span> <span class="n">gmismatch</span><span class="p">)</span>
		<span class="n">freqcats</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldbfunc</span><span class="p">)</span> <span class="o">|</span> <span class="nb">set</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">candbfunc</span><span class="p">),</span>
				<span class="n">key</span><span class="o">=</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldbfunc</span><span class="p">[</span><span class="n">x</span><span class="p">]),</span> <span class="n">reverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">cat</span><span class="p">,</span> <span class="n">mismatch</span> <span class="ow">in</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">freqcats</span><span class="p">[:</span><span class="n">limit</span><span class="p">],</span>
				<span class="n">wrong</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">limit</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">cat</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="mi">39</span> <span class="o">*</span> <span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">  </span><span class="si">%6.2f</span><span class="s">  </span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">cat</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
					<span class="mi">100</span> <span class="o">*</span> <span class="nb">sum</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldbfunc</span><span class="p">[</span><span class="n">cat</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">())</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldfun</span><span class="p">),</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">recall</span><span class="p">(</span>
							<span class="n">acc</span><span class="o">.</span><span class="n">goldbfunc</span><span class="p">[</span><span class="n">cat</span><span class="p">],</span> <span class="n">acc</span><span class="o">.</span><span class="n">candbfunc</span><span class="p">[</span><span class="n">cat</span><span class="p">])),</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">precision</span><span class="p">(</span>
							<span class="n">acc</span><span class="o">.</span><span class="n">goldbfunc</span><span class="p">[</span><span class="n">cat</span><span class="p">],</span> <span class="n">acc</span><span class="o">.</span><span class="n">candbfunc</span><span class="p">[</span><span class="n">cat</span><span class="p">])),</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span>
							<span class="n">acc</span><span class="o">.</span><span class="n">goldbfunc</span><span class="p">[</span><span class="n">cat</span><span class="p">],</span> <span class="n">acc</span><span class="o">.</span><span class="n">candbfunc</span><span class="p">[</span><span class="n">cat</span><span class="p">])),</span>
					<span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">mismatch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39;       </span><span class="si">%s</span><span class="s"> </span><span class="si">%7d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">mismatch</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
						<span class="n">mismatch</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">))),</span> <span class="n">mismatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
			<span class="k">print</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Evaluator.tagbreakdown"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.Evaluator.tagbreakdown">[docs]</a>	<span class="k">def</span> <span class="nf">tagbreakdown</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">10</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Print breakdowns for the most frequent tags.&quot;&quot;&quot;</span>
		<span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s"> POS Statistics (</span><span class="si">%s</span><span class="s"> tags / errors)&#39;</span> <span class="o">%</span> <span class="p">(</span>
			<span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s"> most frequent&#39;</span> <span class="o">%</span> <span class="n">limit</span><span class="p">)</span> <span class="k">if</span> <span class="n">limit</span> <span class="k">else</span> <span class="s">&#39;all&#39;</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">    tag  </span><span class="si">% g</span><span class="s">old  recall   prec.      F1&#39;</span><span class="p">,</span>
				<span class="s">&#39;          cand gold   count&#39;</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="mi">38</span> <span class="o">*</span> <span class="s">&#39;_&#39;</span> <span class="o">+</span> <span class="mi">12</span> <span class="o">*</span> <span class="s">&#39; &#39;</span> <span class="o">+</span> <span class="mi">20</span> <span class="o">*</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
		<span class="n">tags</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldpos</span><span class="p">)</span>
		<span class="n">wrong</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">((</span><span class="n">c</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span><span class="p">,</span> <span class="n">g</span>
				<span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">candpos</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldpos</span><span class="p">)</span> <span class="k">if</span> <span class="n">c</span> <span class="o">!=</span> <span class="n">g</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">tag</span><span class="p">,</span> <span class="n">mismatch</span> <span class="ow">in</span> <span class="n">zip_longest</span><span class="p">(</span><span class="n">tags</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">limit</span><span class="p">),</span>
				<span class="n">wrong</span><span class="o">.</span><span class="n">most_common</span><span class="p">(</span><span class="n">limit</span><span class="p">)):</span>
			<span class="k">if</span> <span class="n">tag</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">40</span><span class="p">),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="c"># only one tag per index may occur, but multiset is required by</span>
				<span class="c"># metrics</span>
				<span class="n">goldtag</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldpos</span><span class="p">)</span>
						<span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="n">candtag</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(</span><span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">candpos</span><span class="p">)</span>
						<span class="k">if</span> <span class="n">t</span> <span class="o">==</span> <span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">  </span><span class="si">%6.2f</span><span class="s">  </span><span class="si">%6.2f</span><span class="s">  </span><span class="si">%6.2f</span><span class="s">  </span><span class="si">%6.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
						<span class="n">tag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">7</span><span class="p">),</span>
						<span class="mi">100</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">goldtag</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldpos</span><span class="p">),</span>
						<span class="mi">100</span> <span class="o">*</span> <span class="n">recall</span><span class="p">(</span><span class="n">goldtag</span><span class="p">,</span> <span class="n">candtag</span><span class="p">),</span>
						<span class="mi">100</span> <span class="o">*</span> <span class="n">precision</span><span class="p">(</span><span class="n">goldtag</span><span class="p">,</span> <span class="n">candtag</span><span class="p">),</span>
						<span class="mi">100</span> <span class="o">*</span> <span class="n">f_measure</span><span class="p">(</span><span class="n">goldtag</span><span class="p">,</span> <span class="n">candtag</span><span class="p">)),</span> <span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">mismatch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39;       </span><span class="si">%s</span><span class="s"> </span><span class="si">%7d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">mismatch</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span>
						<span class="n">mismatch</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">8</span><span class="p">)))</span><span class="o">.</span><span class="n">rjust</span><span class="p">(</span><span class="mi">12</span><span class="p">),</span> <span class="n">mismatch</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
						<span class="n">end</span><span class="o">=</span><span class="s">&#39;&#39;</span><span class="p">)</span>
			<span class="k">print</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="Evaluator.summary"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.Evaluator.summary">[docs]</a>	<span class="k">def</span> <span class="nf">summary</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;:returns: a string with an overview of scores for all sentences.&quot;&quot;&quot;</span>
		<span class="n">acc</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc</span>
		<span class="n">acc40</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">acc40</span>
		<span class="n">discbrackets</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="o">.</span><span class="n">elements</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">bitfanout</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">gdiscbrackets</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="o">.</span><span class="n">elements</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">bitfanout</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>

		<span class="k">if</span> <span class="n">acc</span><span class="o">.</span><span class="n">maxlenseen</span> <span class="o">&lt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;CUTOFF_LEN&#39;</span><span class="p">]:</span>
			<span class="n">msg</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39; Summary (ALL) &#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">35</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">),</span>
				<span class="s">&#39;number of sentences:       </span><span class="si">%6d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">sentcount</span><span class="p">),</span>
				<span class="s">&#39;longest sentence:          </span><span class="si">%6d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">maxlenseen</span><span class="p">)]</span>
			<span class="k">if</span> <span class="n">gdiscbrackets</span> <span class="ow">or</span> <span class="n">discbrackets</span><span class="p">:</span>
				<span class="n">msg</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;gold brackets (disc.):     </span><span class="si">%6d</span><span class="s"> (</span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
							<span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="p">),</span> <span class="n">gdiscbrackets</span><span class="p">),</span>
						<span class="s">&#39;cand. brackets (disc.):    </span><span class="si">%6d</span><span class="s"> (</span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
							<span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="p">),</span> <span class="n">discbrackets</span><span class="p">)])</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">msg</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;gold brackets:             </span><span class="si">%6d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="p">),</span>
					<span class="s">&#39;cand. brackets:            </span><span class="si">%6d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="p">)])</span>
			<span class="n">msg</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span>
					<span class="s">&#39;labeled recall:            </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
						<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">recall</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="p">))),</span>
					<span class="s">&#39;labeled precision:         </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
						<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">precision</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="p">))),</span>
					<span class="s">&#39;labeled f-measure:         </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
						<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="p">))),</span>
					<span class="s">&#39;exact match:               </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
						<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">acc</span><span class="o">.</span><span class="n">exact</span> <span class="o">/</span> <span class="n">acc</span><span class="o">.</span><span class="n">sentcount</span><span class="p">))])</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;LA&#39;</span><span class="p">]:</span>
				<span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;leaf-ancestor:             </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
						<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">mean</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">lascores</span><span class="p">))))</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;TED&#39;</span><span class="p">]:</span>
				<span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;tree-dist (Dice micro avg) </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
						<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">dicenoms</span> <span class="o">/</span> <span class="n">acc</span><span class="o">.</span><span class="n">dicedenoms</span><span class="p">)))</span>
			<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DEP&#39;</span><span class="p">]:</span>
				<span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;unlabeled dependencies:    </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
						<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">golddep</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">canddep</span><span class="p">))))</span>
			<span class="k">if</span> <span class="n">acc</span><span class="o">.</span><span class="n">candfun</span><span class="p">:</span>
				<span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;function tags:             </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span>
						<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldfun</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">candfun</span><span class="p">)))</span>
			<span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;pos accuracy:              </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldpos</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">candpos</span><span class="p">))))</span>
			<span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

		<span class="n">discbrackets40</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="n">acc40</span><span class="o">.</span><span class="n">candb</span><span class="o">.</span><span class="n">elements</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">bitfanout</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">gdiscbrackets40</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="n">acc40</span><span class="o">.</span><span class="n">goldb</span><span class="o">.</span><span class="n">elements</span><span class="p">()</span>
				<span class="k">if</span> <span class="n">bitfanout</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">msg</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> &lt;= </span><span class="si">%d</span><span class="s"> ______ ALL&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="s">&#39; Summary &#39;</span><span class="o">.</span><span class="n">center</span><span class="p">(</span><span class="mi">27</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;CUTOFF_LEN&#39;</span><span class="p">]),</span>
			<span class="s">&#39;number of sentences:       </span><span class="si">%6d</span><span class="s">     </span><span class="si">%6d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">acc40</span><span class="o">.</span><span class="n">sentcount</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">sentcount</span><span class="p">),</span>
			<span class="s">&#39;longest sentence:          </span><span class="si">%6d</span><span class="s">     </span><span class="si">%6d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">acc40</span><span class="o">.</span><span class="n">maxlenseen</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">maxlenseen</span><span class="p">),</span>
			<span class="s">&#39;gold brackets:             </span><span class="si">%6d</span><span class="s">     </span><span class="si">%6d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="nb">len</span><span class="p">(</span><span class="n">acc40</span><span class="o">.</span><span class="n">goldb</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="p">)),</span>
			<span class="s">&#39;cand. brackets:            </span><span class="si">%6d</span><span class="s">     </span><span class="si">%6d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="nb">len</span><span class="p">(</span><span class="n">acc40</span><span class="o">.</span><span class="n">candb</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="p">))]</span>
		<span class="k">if</span> <span class="n">gdiscbrackets</span> <span class="ow">or</span> <span class="n">discbrackets</span><span class="p">:</span>
			<span class="n">msg</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;disc. gold brackets:       </span><span class="si">%6d</span><span class="s">     </span><span class="si">%6d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">gdiscbrackets40</span><span class="p">,</span> <span class="n">gdiscbrackets</span><span class="p">),</span>
					<span class="s">&#39;disc. cand. brackets:      </span><span class="si">%6d</span><span class="s">     </span><span class="si">%6d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">discbrackets40</span><span class="p">,</span> <span class="n">discbrackets</span><span class="p">)])</span>
		<span class="n">msg</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s">&#39;labeled recall:            </span><span class="si">%s</span><span class="s">     </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">recall</span><span class="p">(</span><span class="n">acc40</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="n">acc40</span><span class="o">.</span><span class="n">candb</span><span class="p">)),</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">recall</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="p">))),</span>
			<span class="s">&#39;labeled precision:         </span><span class="si">%s</span><span class="s">     </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">precision</span><span class="p">(</span><span class="n">acc40</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="n">acc40</span><span class="o">.</span><span class="n">candb</span><span class="p">)),</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">precision</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="p">))),</span>
			<span class="s">&#39;labeled f-measure:         </span><span class="si">%s</span><span class="s">     </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="n">acc40</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="n">acc40</span><span class="o">.</span><span class="n">candb</span><span class="p">)),</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">candb</span><span class="p">))),</span>
			<span class="s">&#39;exact match:               </span><span class="si">%s</span><span class="s">     </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">acc40</span><span class="o">.</span><span class="n">exact</span> <span class="o">/</span> <span class="n">acc40</span><span class="o">.</span><span class="n">sentcount</span><span class="p">),</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">acc</span><span class="o">.</span><span class="n">exact</span> <span class="o">/</span> <span class="n">acc</span><span class="o">.</span><span class="n">sentcount</span><span class="p">))])</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;LA&#39;</span><span class="p">]:</span>
			<span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;leaf-ancestor:             </span><span class="si">%s</span><span class="s">     </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">mean</span><span class="p">(</span><span class="n">acc40</span><span class="o">.</span><span class="n">lascores</span><span class="p">)),</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">mean</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">lascores</span><span class="p">))))</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;TED&#39;</span><span class="p">]:</span>
			<span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;tree-dist (Dice micro avg) </span><span class="si">%s</span><span class="s">     </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">acc40</span><span class="o">.</span><span class="n">dicenoms</span> <span class="o">/</span> <span class="n">acc40</span><span class="o">.</span><span class="n">dicedenoms</span><span class="p">)),</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">acc</span><span class="o">.</span><span class="n">dicenoms</span> <span class="o">/</span> <span class="n">acc</span><span class="o">.</span><span class="n">dicedenoms</span><span class="p">))))</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DEP&#39;</span><span class="p">]:</span>
			<span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;unlabeled dependencies:    </span><span class="si">%s</span><span class="s">     </span><span class="si">%s</span><span class="s">  (</span><span class="si">%d</span><span class="s"> / </span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">acc40</span><span class="o">.</span><span class="n">golddep</span><span class="p">,</span> <span class="n">acc40</span><span class="o">.</span><span class="n">canddep</span><span class="p">)),</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">golddep</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">canddep</span><span class="p">)),</span>
					<span class="nb">sum</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">golddep</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">canddep</span><span class="p">)),</span>
					<span class="nb">len</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">golddep</span><span class="p">)))</span>
		<span class="k">if</span> <span class="n">acc</span><span class="o">.</span><span class="n">candfun</span><span class="p">:</span>
			<span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;function tags:             </span><span class="si">%s</span><span class="s">     </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="n">acc40</span><span class="o">.</span><span class="n">goldfun</span><span class="p">,</span> <span class="n">acc40</span><span class="o">.</span><span class="n">candfun</span><span class="p">)),</span>
					<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldfun</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">candfun</span><span class="p">))))</span>
		<span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;pos accuracy:              </span><span class="si">%s</span><span class="s">     </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">acc40</span><span class="o">.</span><span class="n">goldpos</span><span class="p">,</span> <span class="n">acc40</span><span class="o">.</span><span class="n">candpos</span><span class="p">)),</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">(</span><span class="n">acc</span><span class="o">.</span><span class="n">goldpos</span><span class="p">,</span> <span class="n">acc</span><span class="o">.</span><span class="n">candpos</span><span class="p">))))</span>
		<span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="TreePairResult"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.TreePairResult">[docs]</a><span class="k">class</span> <span class="nc">TreePairResult</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Holds the evaluation result of a pair of trees.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">gtree</span><span class="p">,</span> <span class="n">gsent</span><span class="p">,</span> <span class="n">ctree</span><span class="p">,</span> <span class="n">csent</span><span class="p">,</span> <span class="n">param</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Construct a pair of gold and candidate trees for evaluation.&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">n</span> <span class="o">=</span> <span class="n">n</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">param</span> <span class="o">=</span> <span class="n">param</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">csentorig</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsentorig</span> <span class="o">=</span> <span class="n">csent</span><span class="p">,</span> <span class="n">gsent</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">csent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsent</span> <span class="o">=</span> <span class="n">csent</span><span class="p">[:],</span> <span class="n">gsent</span><span class="p">[:]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpos</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">ctree</span><span class="o">.</span><span class="n">pos</span><span class="p">()),</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">gtree</span><span class="o">.</span><span class="n">pos</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lengpos</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpos</span>
				<span class="k">if</span> <span class="n">b</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL_FOR_LENGTH&#39;</span><span class="p">])</span>
		<span class="n">grootpos</span> <span class="o">=</span> <span class="p">{</span><span class="n">child</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">gtree</span>
				<span class="k">if</span> <span class="n">child</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)}</span>
		<span class="c"># massage the data (in-place modifications)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ctree</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">ctree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">csent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpos</span><span class="p">,</span>
				<span class="n">alignsent</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsent</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpos</span><span class="p">)),</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">,</span> <span class="n">grootpos</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">gtree</span> <span class="o">=</span> <span class="n">transform</span><span class="p">(</span><span class="n">gtree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsent</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpos</span><span class="p">,</span>
				<span class="nb">dict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpos</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">,</span> <span class="n">grootpos</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csent</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gsent</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;sentence length mismatch. sents:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">csent</span><span class="p">),</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gsent</span><span class="p">)))</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">csent</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsent</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;candidate &amp; gold sentences do not match:</span><span class="se">\n</span><span class="s">&#39;</span>
					<span class="s">&#39;</span><span class="si">%r</span><span class="s"> // </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">csent</span><span class="p">),</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">gsent</span><span class="p">)))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span> <span class="o">=</span> <span class="n">bracketings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;LABELED&#39;</span><span class="p">],</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DISC_ONLY&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span> <span class="o">=</span> <span class="n">bracketings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;LABELED&#39;</span><span class="p">],</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DISC_ONLY&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lascore</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">denom</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;nan&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">cdep</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gdep</span> <span class="o">=</span> <span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pgbrack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pcbrack</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">grule</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">crule</span> <span class="o">=</span> <span class="p">()</span>
		<span class="c"># collect the function tags for correct bracketings &amp; POS tags</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">candfun</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">((</span><span class="n">bracketing</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">b</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">()</span>
					<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">bracketing</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span> <span class="ow">or</span> <span class="p">(</span>
						<span class="n">a</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
						<span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpos</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">((</span><span class="n">bracketing</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">b</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">()</span>
					<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">bracketing</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span> <span class="ow">or</span> <span class="p">(</span>
						<span class="n">a</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
						<span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpos</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">==</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="p">))</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpos</span><span class="p">:</span>
			<span class="k">return</span>  <span class="c"># avoid &#39;sentences&#39; with only punctuation.</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;LA&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">lascore</span> <span class="o">=</span> <span class="n">leafancestor</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="p">,</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;TED&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">ted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">denom</span> <span class="o">=</span> <span class="n">treedisteval</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="p">,</span>
				<span class="n">includeroot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="o">.</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DEP&#39;</span><span class="p">]:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">cdep</span> <span class="o">=</span> <span class="n">dependencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">gdep</span> <span class="o">=</span> <span class="n">dependencies</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="p">)</span>
		<span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">lascore</span> <span class="o">!=</span> <span class="mi">1</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">,</span> <span class="p">(</span>
				<span class="s">&#39;leaf ancestor score 1.0 but no exact match: (bug?)&#39;</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pgbrack</span> <span class="o">=</span> <span class="n">parentedbracketings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="p">,</span> <span class="n">labeled</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
				<span class="n">dellabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">],</span>
				<span class="n">disconly</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DISC_ONLY&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">pcbrack</span> <span class="o">=</span> <span class="n">parentedbracketings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="p">,</span> <span class="n">labeled</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
				<span class="n">dellabel</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">],</span>
				<span class="n">disconly</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DISC_ONLY&#39;</span><span class="p">])</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">grule</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">((</span><span class="n">node</span><span class="o">.</span><span class="n">bitset</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">(),</span>
				<span class="n">grammar</span><span class="o">.</span><span class="n">lcfrsproductions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsent</span><span class="p">)))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">crule</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">((</span><span class="n">node</span><span class="o">.</span><span class="n">bitset</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">node</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">(),</span>
				<span class="n">grammar</span><span class="o">.</span><span class="n">lcfrsproductions</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">csent</span><span class="p">)))</span>

<div class="viewcode-block" id="TreePairResult.info"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.TreePairResult.info">[docs]</a>	<span class="k">def</span> <span class="nf">info</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s">&#39;</span><span class="si">%8s</span><span class="s">  &#39;</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Print one line with evaluation results.&quot;&quot;&quot;</span>
		<span class="k">print</span><span class="p">((</span><span class="n">fmt</span> <span class="o">+</span> <span class="s">&#39;</span><span class="si">%5d</span><span class="s">  </span><span class="si">%s</span><span class="s">  </span><span class="si">%s</span><span class="s">   </span><span class="si">%5d</span><span class="s">  </span><span class="si">%5d</span><span class="s">  </span><span class="si">%5d</span><span class="s">  </span><span class="si">%5d</span><span class="s">  </span><span class="si">%4d</span><span class="s">  </span><span class="si">%s</span><span class="s"> </span><span class="si">%s%s%s%s</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">%</span> <span class="p">(</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lengpos</span><span class="p">,</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">recall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">)),</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">precision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">)),</span>
				<span class="nb">sum</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
				<span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span> <span class="nb">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="o">.</span><span class="n">values</span><span class="p">()),</span>
				<span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpos</span><span class="p">),</span>
				<span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpos</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">),</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpos</span><span class="p">)),</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span><span class="p">))</span>
						<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="mi">100</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">lascore</span><span class="p">)</span>
						<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;LA&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">ted</span><span class="p">)</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;TED&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span>
				<span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdep</span><span class="p">))</span>
						<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DEP&#39;</span><span class="p">]</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="TreePairResult.debug"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.TreePairResult.debug">[docs]</a>	<span class="k">def</span> <span class="nf">debug</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Print detailed information.&quot;&quot;&quot;</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;Sentence:&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gsent</span><span class="p">))</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;Gold tree:</span><span class="se">\n</span><span class="si">%s</span><span class="se">\n</span><span class="s">Candidate tree:</span><span class="se">\n</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">gold</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">visualize</span><span class="p">(</span><span class="n">gold</span><span class="o">=</span><span class="bp">False</span><span class="p">)))</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;Gold brackets:      &#39;</span><span class="p">,</span> <span class="n">strbracketings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="p">))</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;Candidate brackets: &#39;</span><span class="p">,</span> <span class="n">strbracketings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">))</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;Matched brackets:   &#39;</span><span class="p">,</span>
				<span class="n">strbracketings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">))</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;Unmatched brackets: &#39;</span><span class="p">,</span> <span class="n">strbracketings</span><span class="p">(</span>
				<span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">)))</span>
		<span class="n">goldpaths</span> <span class="o">=</span> <span class="n">leafancestorpaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">])</span>
		<span class="n">candpaths</span> <span class="o">=</span> <span class="n">leafancestorpaths</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">])</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;Function tags&#39;</span><span class="p">)</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;gold:               &#39;</span><span class="p">,</span> <span class="n">strbracketings</span><span class="p">(</span>
					<span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span><span class="p">))</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;candidate:          &#39;</span><span class="p">,</span> <span class="n">strbracketings</span><span class="p">(</span>
					<span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span><span class="p">))</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;matched:            &#39;</span><span class="p">,</span> <span class="n">strbracketings</span><span class="p">(</span>
					<span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span><span class="p">))</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;unmatched:          &#39;</span><span class="p">,</span> <span class="n">strbracketings</span><span class="p">(</span>
					<span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="n">a</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">candfun</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span><span class="p">)</span>
					<span class="o">|</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span><span class="p">)))</span>

		<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%15s</span><span class="s"> </span><span class="si">%8s</span><span class="s"> </span><span class="si">%8s</span><span class="s"> | </span><span class="si">%10s</span><span class="s"> </span><span class="si">%36s</span><span class="s"> : </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="s">&#39;word&#39;</span><span class="p">,</span> <span class="s">&#39;gold POS&#39;</span><span class="p">,</span> <span class="s">&#39;cand POS&#39;</span><span class="p">,</span>
				<span class="s">&#39;path score&#39;</span><span class="p">,</span> <span class="s">&#39;gold path&#39;</span><span class="p">,</span> <span class="s">&#39;cand path&#39;</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">goldpaths</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%15s</span><span class="s"> </span><span class="si">%8s</span><span class="s"> </span><span class="si">%8s</span><span class="s">   </span><span class="si">%6.3g</span><span class="s"> </span><span class="si">%40s</span><span class="s"> : </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">gsent</span><span class="p">[</span><span class="n">leaf</span><span class="p">],</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">gpos</span><span class="p">[</span><span class="n">leaf</span><span class="p">],</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">cpos</span><span class="p">[</span><span class="n">leaf</span><span class="p">],</span>
					<span class="n">pathscore</span><span class="p">(</span><span class="n">goldpaths</span><span class="p">[</span><span class="n">leaf</span><span class="p">],</span> <span class="n">candpaths</span><span class="p">[</span><span class="n">leaf</span><span class="p">]),</span>
					<span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">goldpaths</span><span class="p">[</span><span class="n">leaf</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span>
					<span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">candpaths</span><span class="p">[</span><span class="n">leaf</span><span class="p">][::</span><span class="o">-</span><span class="mi">1</span><span class="p">])))</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;LA&#39;</span><span class="p">]:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;leaf-ancestor score: </span><span class="si">%6.3g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">lascore</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;TED&#39;</span><span class="p">]:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;Tree-dist: </span><span class="si">%g</span><span class="s"> / </span><span class="si">%g</span><span class="s"> = </span><span class="si">%g</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">ted</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">denom</span><span class="p">,</span> <span class="mi">1</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">ted</span> <span class="o">/</span> <span class="n">Decimal</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denom</span><span class="p">)))</span>
			<span class="n">newtreedist</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="p">,</span> <span class="bp">True</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DEP&#39;</span><span class="p">]:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;Sentence:&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gsent</span><span class="p">))</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;dependencies gold&#39;</span><span class="p">,</span> <span class="s">&#39; &#39;</span> <span class="o">*</span> <span class="mi">35</span><span class="p">,</span> <span class="s">&#39;cand&#39;</span><span class="p">)</span>
			<span class="k">for</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">b</span><span class="p">),</span> <span class="p">(</span><span class="n">c</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">d</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gdep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cdep</span><span class="p">):</span>
				<span class="c"># use original sentences because we don&#39;t delete</span>
				<span class="c"># punctuation for dependency evaluation</span>
				<span class="k">print</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%15s</span><span class="s"> -&gt; </span><span class="si">%15s</span><span class="s">           </span><span class="si">%15s</span><span class="s"> -&gt; </span><span class="si">%15s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">gsentorig</span><span class="p">[</span><span class="n">a</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">gsentorig</span><span class="p">[</span><span class="n">b</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
					<span class="bp">self</span><span class="o">.</span><span class="n">csentorig</span><span class="p">[</span><span class="n">c</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="bp">self</span><span class="o">.</span><span class="n">csentorig</span><span class="p">[</span><span class="n">d</span> <span class="o">-</span> <span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]))</span>
		<span class="k">print</span><span class="p">()</span>
</div>
<div class="viewcode-block" id="TreePairResult.scores"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.TreePairResult.scores">[docs]</a>	<span class="k">def</span> <span class="nf">scores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Return precision, recall, f-measure for sentence pair.&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">LP</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">precision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">)),</span>
				<span class="n">LR</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">recall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">)),</span>
				<span class="n">LF</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">)),</span>
				<span class="n">POS</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpos</span><span class="p">)),</span>
				<span class="n">FUN</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span><span class="p">)))</span>
</div>
<div class="viewcode-block" id="TreePairResult.bracketings"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.TreePairResult.bracketings">[docs]</a>	<span class="k">def</span> <span class="nf">bracketings</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Return a string representation of bracketing errors.&quot;&quot;&quot;</span>
		<span class="n">msg</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="p">:</span>
			<span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;cand-gold=</span><span class="si">%s</span><span class="s"> &#39;</span> <span class="o">%</span> <span class="n">strbracketings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">:</span>
			<span class="n">msg</span> <span class="o">+=</span> <span class="s">&#39;gold-cand=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">strbracketings</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">msg</span>
</div>
<div class="viewcode-block" id="TreePairResult.visualize"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.TreePairResult.visualize">[docs]</a>	<span class="k">def</span> <span class="nf">visualize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">gold</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Visualize candidate parse, highlight matching POS, bracketings.</span>

<span class="sd">		:param gold: by default, the candidate tree is visualized; if True,</span>
<span class="sd">			visualize the gold tree instead.&quot;&quot;&quot;</span>
		<span class="n">tree</span><span class="p">,</span> <span class="n">brack</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ctree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gbrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">gpos</span>
		<span class="k">if</span> <span class="n">gold</span><span class="p">:</span>
			<span class="n">tree</span><span class="p">,</span> <span class="n">brack</span><span class="p">,</span> <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gtree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cbrack</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">cpos</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">tree</span><span class="p">:</span>  <span class="c"># avoid empty trees with just punctuation</span>
			<span class="k">return</span> <span class="s">&#39;&#39;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span><span class="p">:</span>
			<span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="bp">True</span><span class="p">)</span>
		<span class="n">highlight</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">bracketing</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="ow">in</span> <span class="n">brack</span><span class="p">))</span>
		<span class="n">highlight</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">(</span><span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
				<span class="ow">and</span> <span class="n">n</span><span class="o">.</span><span class="n">label</span> <span class="o">==</span> <span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">]]))</span>
		<span class="n">highlight</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">pos</span><span class="p">)))</span>
		<span class="n">highlightfunc</span> <span class="o">=</span> <span class="p">()</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span><span class="p">:</span>
			<span class="n">highlightfunc</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">()</span>
					<span class="k">if</span> <span class="nb">all</span><span class="p">((</span><span class="n">bracketing</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">b</span><span class="p">)</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span> <span class="o">&amp;</span> <span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span>
						<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">functions</span><span class="p">(</span><span class="n">a</span><span class="p">))]</span>
			<span class="n">handlefunctions</span><span class="p">(</span><span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">DrawTree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">csent</span><span class="p">,</span> <span class="n">highlight</span><span class="o">=</span><span class="n">highlight</span><span class="p">,</span>
				<span class="n">highlightfunc</span><span class="o">=</span><span class="n">highlightfunc</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
				<span class="n">unicodelines</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">ansi</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span>
				<span class="n">funcsep</span><span class="o">=</span><span class="s">&#39;-&#39;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span> <span class="k">else</span> <span class="bp">None</span><span class="p">)</span>

</div></div>
<div class="viewcode-block" id="EvalAccumulator"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.EvalAccumulator">[docs]</a><span class="k">class</span> <span class="nc">EvalAccumulator</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Collect scores of evaluation.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">disconly</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;:param disconly: if True, only collect discontinuous bracketings.&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">disconly</span> <span class="o">=</span> <span class="n">disconly</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">maxlenseen</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentcount</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">exact</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">dicenoms</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">dicedenoms</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candb</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(),</span> <span class="n">Counter</span><span class="p">()</span>  <span class="c"># all brackets</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(),</span> <span class="n">Counter</span><span class="p">()</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lascores</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">golddep</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">canddep</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candpos</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
		<span class="c"># extra accounting for breakdowns:</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldbcat</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Counter</span><span class="p">)</span>  <span class="c"># brackets per category</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">candbcat</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Counter</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldbfunc</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Counter</span><span class="p">)</span>  <span class="c"># brackets by function tag</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">candbfunc</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="n">Counter</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldbatt</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candbatt</span> <span class="o">=</span> <span class="nb">set</span><span class="p">(),</span> <span class="nb">set</span><span class="p">()</span>  <span class="c"># attachments per category</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldrule</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candrule</span> <span class="o">=</span> <span class="n">Counter</span><span class="p">(),</span> <span class="n">Counter</span><span class="p">()</span>

<div class="viewcode-block" id="EvalAccumulator.add"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.EvalAccumulator.add">[docs]</a>	<span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pair</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Add scores from given TreePairResult object.&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disconly</span> <span class="ow">or</span> <span class="n">pair</span><span class="o">.</span><span class="n">cbrack</span> <span class="ow">or</span> <span class="n">pair</span><span class="o">.</span><span class="n">gbrack</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">sentcount</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">maxlenseen</span> <span class="o">&lt;</span> <span class="n">pair</span><span class="o">.</span><span class="n">lengpos</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">maxlenseen</span> <span class="o">=</span> <span class="n">pair</span><span class="o">.</span><span class="n">lengpos</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">candb</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">cbrack</span><span class="o">.</span><span class="n">elements</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldb</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">gbrack</span><span class="o">.</span><span class="n">elements</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">pair</span><span class="o">.</span><span class="n">cbrack</span> <span class="o">==</span> <span class="n">pair</span><span class="o">.</span><span class="n">gbrack</span><span class="p">:</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">disconly</span> <span class="ow">or</span> <span class="n">pair</span><span class="o">.</span><span class="n">cbrack</span> <span class="ow">or</span> <span class="n">pair</span><span class="o">.</span><span class="n">gbrack</span><span class="p">:</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">exact</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldpos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pair</span><span class="o">.</span><span class="n">gpos</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">candpos</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pair</span><span class="o">.</span><span class="n">cpos</span><span class="p">)</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">goldfun</span><span class="o">.</span><span class="n">elements</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">candfun</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">candfun</span><span class="o">.</span><span class="n">elements</span><span class="p">())</span>
		<span class="k">if</span> <span class="n">pair</span><span class="o">.</span><span class="n">lascore</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">lascores</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pair</span><span class="o">.</span><span class="n">lascore</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">pair</span><span class="o">.</span><span class="n">ted</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dicenoms</span> <span class="o">+=</span> <span class="n">pair</span><span class="o">.</span><span class="n">ted</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">dicedenoms</span> <span class="o">+=</span> <span class="n">pair</span><span class="o">.</span><span class="n">denom</span>
		<span class="k">if</span> <span class="n">pair</span><span class="o">.</span><span class="n">gdep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">golddep</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pair</span><span class="o">.</span><span class="n">gdep</span><span class="p">)</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">canddep</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pair</span><span class="o">.</span><span class="n">cdep</span><span class="p">)</span>
		<span class="c"># extra bookkeeping for breakdowns</span>
		<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">gbrack</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">goldbcat</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]][(</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">n</span>
		<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">cbrack</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">candbcat</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]][(</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">n</span>
		<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">goldfun</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">goldbfunc</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]][(</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">n</span>
		<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">candfun</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">candbfunc</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]][(</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="p">)]</span> <span class="o">+=</span> <span class="n">n</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">indices</span><span class="p">),</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">pgbrack</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">goldbatt</span><span class="o">.</span><span class="n">add</span><span class="p">(((</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">indices</span><span class="p">),</span> <span class="n">parent</span><span class="p">))</span>
		<span class="k">for</span> <span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">indices</span><span class="p">),</span> <span class="n">parent</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">pcbrack</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">candbatt</span><span class="o">.</span><span class="n">add</span><span class="p">(((</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">indices</span><span class="p">),</span> <span class="n">parent</span><span class="p">))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">goldrule</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">indices</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">grule</span><span class="o">.</span><span class="n">elements</span><span class="p">())</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">candrule</span><span class="o">.</span><span class="n">update</span><span class="p">((</span><span class="n">pair</span><span class="o">.</span><span class="n">n</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="n">rule</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">indices</span><span class="p">,</span> <span class="n">rule</span> <span class="ow">in</span> <span class="n">pair</span><span class="o">.</span><span class="n">crule</span><span class="o">.</span><span class="n">elements</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="EvalAccumulator.scores"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.EvalAccumulator.scores">[docs]</a>	<span class="k">def</span> <span class="nf">scores</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Return a dictionary with running scores for all added sentences.&quot;&quot;&quot;</span>
		<span class="k">return</span> <span class="nb">dict</span><span class="p">(</span><span class="n">lr</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">recall</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candb</span><span class="p">)),</span>
				<span class="n">lp</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">precision</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candb</span><span class="p">)),</span>
				<span class="n">lf</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goldb</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candb</span><span class="p">)),</span>
				<span class="n">ex</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">exact</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">sentcount</span><span class="p">),</span>
				<span class="n">tag</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">accuracy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goldpos</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candpos</span><span class="p">)),</span>
				<span class="n">fun</span><span class="o">=</span><span class="n">nozerodiv</span><span class="p">(</span><span class="k">lambda</span><span class="p">:</span> <span class="n">f_measure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">goldfun</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">candfun</span><span class="p">)))</span>

</div></div>
<div class="viewcode-block" id="main"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.main">[docs]</a><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>
	<span class="sd">&quot;&quot;&quot;Command line interface for evaluation.&quot;&quot;&quot;</span>
	<span class="n">flags</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;help&#39;</span><span class="p">,</span> <span class="s">&#39;verbose&#39;</span><span class="p">,</span> <span class="s">&#39;debug&#39;</span><span class="p">,</span> <span class="s">&#39;disconly&#39;</span><span class="p">,</span> <span class="s">&#39;ted&#39;</span><span class="p">,</span> <span class="s">&#39;la&#39;</span><span class="p">}</span>
	<span class="n">options</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;goldenc=&#39;</span><span class="p">,</span> <span class="s">&#39;parsesenc=&#39;</span><span class="p">,</span> <span class="s">&#39;goldfmt=&#39;</span><span class="p">,</span> <span class="s">&#39;parsesfmt=&#39;</span><span class="p">,</span> <span class="s">&#39;fmt=&#39;</span><span class="p">,</span>
			<span class="s">&#39;cutofflen=&#39;</span><span class="p">,</span> <span class="s">&#39;headrules=&#39;</span><span class="p">,</span> <span class="s">&#39;functions=&#39;</span><span class="p">,</span> <span class="s">&#39;morphology=&#39;</span><span class="p">}</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">opts</span><span class="p">,</span> <span class="n">args</span> <span class="o">=</span> <span class="n">gnu_getopt</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="s">&#39;h&#39;</span><span class="p">,</span> <span class="n">flags</span> <span class="o">|</span> <span class="n">options</span><span class="p">)</span>
	<span class="k">except</span> <span class="n">GetoptError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;error:&#39;</span><span class="p">,</span> <span class="n">err</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="n">USAGE</span><span class="p">)</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
	<span class="n">opts</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">opts</span><span class="p">)</span>
	<span class="k">if</span> <span class="s">&#39;--help&#39;</span> <span class="ow">in</span> <span class="n">opts</span> <span class="ow">or</span> <span class="s">&#39;-h&#39;</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="n">USAGE</span><span class="p">)</span>
		<span class="k">return</span>
	<span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;error: Wrong number of arguments.&#39;</span><span class="p">,</span> <span class="nb">file</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="n">SHORTUSAGE</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="k">else</span> <span class="n">USAGE</span><span class="p">)</span>
		<span class="n">sys</span><span class="o">.</span><span class="n">exit</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
	<span class="n">goldfile</span><span class="p">,</span> <span class="n">parsesfile</span> <span class="o">=</span> <span class="n">args</span><span class="p">[:</span><span class="mi">2</span><span class="p">]</span>
	<span class="n">param</span> <span class="o">=</span> <span class="n">readparam</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">3</span> <span class="k">else</span> <span class="bp">None</span><span class="p">)</span>
	<span class="n">param</span><span class="p">[</span><span class="s">&#39;CUTOFF_LEN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--cutofflen&#39;</span><span class="p">,</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;CUTOFF_LEN&#39;</span><span class="p">]))</span>
	<span class="n">param</span><span class="p">[</span><span class="s">&#39;DISC_ONLY&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;--disconly&#39;</span> <span class="ow">in</span> <span class="n">opts</span>
	<span class="n">param</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">],</span>
			<span class="s">&#39;--verbose&#39;</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">,</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="s">&#39;--debug&#39;</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">))</span>
	<span class="n">param</span><span class="p">[</span><span class="s">&#39;TED&#39;</span><span class="p">]</span> <span class="o">|=</span> <span class="s">&#39;--ted&#39;</span> <span class="ow">in</span> <span class="n">opts</span>
	<span class="n">param</span><span class="p">[</span><span class="s">&#39;LA&#39;</span><span class="p">]</span> <span class="o">|=</span> <span class="s">&#39;--la&#39;</span> <span class="ow">in</span> <span class="n">opts</span>
	<span class="n">param</span><span class="p">[</span><span class="s">&#39;DEP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;--headrules&#39;</span> <span class="ow">in</span> <span class="n">opts</span>
	<span class="k">if</span> <span class="s">&#39;--fmt&#39;</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
		<span class="n">opts</span><span class="p">[</span><span class="s">&#39;--goldfmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s">&#39;--parsesfmt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">opts</span><span class="p">[</span><span class="s">&#39;--fmt&#39;</span><span class="p">]</span>
	<span class="n">goldreader</span> <span class="o">=</span> <span class="n">READERS</span><span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--goldfmt&#39;</span><span class="p">,</span> <span class="s">&#39;export&#39;</span><span class="p">)]</span>
	<span class="n">parsesreader</span> <span class="o">=</span> <span class="n">READERS</span><span class="p">[</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--parsesfmt&#39;</span><span class="p">,</span> <span class="s">&#39;export&#39;</span><span class="p">)]</span>
	<span class="n">gold</span> <span class="o">=</span> <span class="n">goldreader</span><span class="p">(</span><span class="n">goldfile</span><span class="p">,</span>
			<span class="n">encoding</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--goldenc&#39;</span><span class="p">,</span> <span class="s">&#39;utf8&#39;</span><span class="p">),</span>
			<span class="n">functions</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--functions&#39;</span><span class="p">,</span> <span class="s">&#39;remove&#39;</span><span class="p">),</span>
			<span class="n">morphology</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--morphology&#39;</span><span class="p">),</span>
			<span class="n">headrules</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--headrules&#39;</span><span class="p">))</span>
	<span class="n">parses</span> <span class="o">=</span> <span class="n">parsesreader</span><span class="p">(</span><span class="n">parsesfile</span><span class="p">,</span>
			<span class="n">encoding</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--parsesenc&#39;</span><span class="p">,</span> <span class="s">&#39;utf8&#39;</span><span class="p">),</span>
			<span class="n">functions</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--functions&#39;</span><span class="p">,</span> <span class="s">&#39;remove&#39;</span><span class="p">),</span>
			<span class="n">morphology</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--morphology&#39;</span><span class="p">),</span>
			<span class="n">headrules</span><span class="o">=</span><span class="n">opts</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;--headrules&#39;</span><span class="p">))</span>
	<span class="n">goldtrees</span><span class="p">,</span> <span class="n">goldsents</span> <span class="o">=</span> <span class="n">gold</span><span class="o">.</span><span class="n">trees</span><span class="p">(),</span> <span class="n">gold</span><span class="o">.</span><span class="n">sents</span><span class="p">()</span>
	<span class="n">candtrees</span><span class="p">,</span> <span class="n">candsents</span> <span class="o">=</span> <span class="n">parses</span><span class="o">.</span><span class="n">trees</span><span class="p">(),</span> <span class="n">parses</span><span class="o">.</span><span class="n">sents</span><span class="p">()</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">goldtrees</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;no trees in gold file&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">candtrees</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;no trees in parses file&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="p">:</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;gold:&#39;</span><span class="p">,</span> <span class="n">goldfile</span><span class="p">)</span>
		<span class="k">print</span><span class="p">(</span><span class="s">&#39;parses:&#39;</span><span class="p">,</span> <span class="n">parsesfile</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
	<span class="n">evaluator</span> <span class="o">=</span> <span class="n">Evaluator</span><span class="p">(</span><span class="n">param</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">key</span><span class="p">))</span> <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">candtrees</span><span class="p">))</span>
	<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">ctree</span> <span class="ow">in</span> <span class="n">candtrees</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
		<span class="n">evaluator</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">goldtrees</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">goldsents</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">ctree</span><span class="p">,</span> <span class="n">candsents</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
	<span class="k">if</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;LABELED&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;DEBUG&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
		<span class="n">evaluator</span><span class="o">.</span><span class="n">breakdowns</span><span class="p">()</span>
	<span class="k">print</span><span class="p">(</span><span class="n">evaluator</span><span class="o">.</span><span class="n">summary</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="readparam"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.readparam">[docs]</a><span class="k">def</span> <span class="nf">readparam</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Read an EVALB-style parameter file and return a dictionary.&quot;&quot;&quot;</span>
	<span class="n">param</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
	<span class="c"># NB: we ignore MAX_ERROR, we abort immediately on error.</span>
	<span class="n">validkeysonce</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;DEBUG&#39;</span><span class="p">,</span> <span class="s">&#39;MAX_ERROR&#39;</span><span class="p">,</span> <span class="s">&#39;CUTOFF_LEN&#39;</span><span class="p">,</span> <span class="s">&#39;LABELED&#39;</span><span class="p">,</span>
			<span class="s">&#39;DISC_ONLY&#39;</span><span class="p">,</span> <span class="s">&#39;LA&#39;</span><span class="p">,</span> <span class="s">&#39;TED&#39;</span><span class="p">,</span> <span class="s">&#39;DEP&#39;</span><span class="p">,</span> <span class="s">&#39;DELETE_ROOT_PRETERMS&#39;</span><span class="p">)</span>
	<span class="n">param</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;DEBUG&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;MAX_ERROR&#39;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s">&#39;CUTOFF_LEN&#39;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span>
				<span class="s">&#39;LABELED&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s">&#39;DELETE_LABEL_FOR_LENGTH&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
				<span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span> <span class="s">&#39;DELETE_WORD&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
				<span class="s">&#39;EQ_LABEL&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span> <span class="s">&#39;EQ_WORD&#39;</span><span class="p">:</span> <span class="nb">set</span><span class="p">(),</span>
				<span class="s">&#39;DISC_ONLY&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;LA&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;TED&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s">&#39;DEP&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
				<span class="s">&#39;DELETE_ROOT_PRETERMS&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">}</span>
	<span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">filename</span> <span class="k">else</span> <span class="p">():</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
		<span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#&#39;</span><span class="p">):</span>
			<span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">validkeysonce</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
					<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;cannot declare </span><span class="si">%s</span><span class="s"> twice&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
				<span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
				<span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">,</span> <span class="s">&#39;DELETE_LABEL_FOR_LENGTH&#39;</span><span class="p">,</span>
					<span class="s">&#39;DELETE_WORD&#39;</span><span class="p">):</span>
				<span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;EQ_LABEL&#39;</span><span class="p">,</span> <span class="s">&#39;EQ_WORD&#39;</span><span class="p">):</span>
				<span class="c"># these are given as undirected pairs (A, B), (B, C), ...</span>
				<span class="c"># to be represented as equivalence classes A =&gt; {A, B, C, D}</span>
				<span class="k">try</span><span class="p">:</span>
					<span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">val</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
				<span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
					<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> requires two values&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
				<span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">((</span><span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">))</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unrecognized parameter key: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">key</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;EQ_LABEL&#39;</span><span class="p">,</span> <span class="s">&#39;EQ_WORD&#39;</span><span class="p">):</span>
		<span class="c"># from arbitrary pairs: [(&#39;A&#39;, &#39;B&#39;), (&#39;B&#39;, &#39;C&#39;)]</span>
		<span class="c"># to eq classes: {&#39;A&#39;: {&#39;A&#39;, &#39;B&#39;, &#39;C&#39;}}</span>
		<span class="c"># to a mapping of all elements to their representative:</span>
		<span class="c"># {&#39;A&#39;: &#39;A&#39;, &#39;B&#39;: &#39;A&#39;, &#39;C&#39;: &#39;A&#39;}</span>
		<span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="n">x</span><span class="p">:</span> <span class="n">k</span>
				<span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">eqclass</span> <span class="ow">in</span> <span class="n">transitiveclosure</span><span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="n">key</span><span class="p">])</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
					<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">eqclass</span><span class="p">}</span>
	<span class="k">return</span> <span class="n">param</span>

</div>
<div class="viewcode-block" id="transitiveclosure"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.transitiveclosure">[docs]</a><span class="k">def</span> <span class="nf">transitiveclosure</span><span class="p">(</span><span class="n">eqpairs</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Transitive closure of (undirected) EQ relations with DFS.</span>

<span class="sd">	Given a sequence of pairs denoting an equivalence relation,</span>
<span class="sd">	produce a dictionary with equivalence classes as values and</span>
<span class="sd">	arbitrary members of those classes as keys.</span>

<span class="sd">	&gt;&gt;&gt; result = transitiveclosure({(&#39;A&#39;, &#39;B&#39;), (&#39;B&#39;, &#39;C&#39;)})</span>
<span class="sd">	&gt;&gt;&gt; len(result)</span>
<span class="sd">	1</span>
<span class="sd">	&gt;&gt;&gt; k, v = result.popitem()</span>
<span class="sd">	&gt;&gt;&gt; k in (&#39;A&#39;, &#39;B&#39;, &#39;C&#39;) and v == {&#39;A&#39;, &#39;B&#39;, &#39;C&#39;}</span>
<span class="sd">	True&quot;&quot;&quot;</span>
	<span class="n">edges</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">set</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">eqpairs</span><span class="p">:</span>
		<span class="n">edges</span><span class="p">[</span><span class="n">a</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
		<span class="n">edges</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
	<span class="n">eqclasses</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">seen</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="nb">set</span><span class="p">(</span><span class="n">edges</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">seen</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="n">eqclasses</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
		<span class="n">agenda</span> <span class="o">=</span> <span class="n">edges</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">elem</span><span class="p">)</span>
		<span class="k">while</span> <span class="n">agenda</span><span class="p">:</span>
			<span class="n">eqelem</span> <span class="o">=</span> <span class="n">agenda</span><span class="o">.</span><span class="n">pop</span><span class="p">()</span>
			<span class="n">seen</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">eqelem</span><span class="p">)</span>
			<span class="n">eqclasses</span><span class="p">[</span><span class="n">elem</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">eqelem</span><span class="p">)</span>
			<span class="n">agenda</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">edges</span><span class="p">[</span><span class="n">eqelem</span><span class="p">]</span> <span class="o">-</span> <span class="n">seen</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">eqclasses</span>

</div>
<div class="viewcode-block" id="alignsent"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.alignsent">[docs]</a><span class="k">def</span> <span class="nf">alignsent</span><span class="p">(</span><span class="n">csent</span><span class="p">,</span> <span class="n">gsent</span><span class="p">,</span> <span class="n">gpos</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Map tokens of ``csent`` onto those of ``gsent``, and translate indices.</span>

<span class="sd">	:returns: a copy of ``gpos`` with indices of ``csent`` as keys,</span>
<span class="sd">		but tags from ``gpos``.</span>

<span class="sd">	&gt;&gt;&gt; gpos = {0: &quot;``&quot;, 1: &#39;RB&#39;, 2: &#39;.&#39;, 3: &quot;&#39;&#39;&quot;}</span>
<span class="sd">	&gt;&gt;&gt; alignsent([&#39;No&#39;], [&#39;``&#39;, &#39;No&#39;, &#39;.&#39;, &quot;&#39;&#39;&quot;], gpos) == {0: &#39;RB&#39;}</span>
<span class="sd">	True&quot;&quot;&quot;</span>
	<span class="n">n</span> <span class="o">=</span> <span class="n">m</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">result</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">while</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">csent</span><span class="p">)</span> <span class="ow">and</span> <span class="n">m</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">gsent</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">csent</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">==</span> <span class="n">gsent</span><span class="p">[</span><span class="n">m</span><span class="p">]:</span>
			<span class="n">result</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">gpos</span><span class="p">[</span><span class="n">m</span><span class="p">]</span>
			<span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
			<span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">m</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="transform"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.transform">[docs]</a><span class="k">def</span> <span class="nf">transform</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">pos</span><span class="p">,</span> <span class="n">gpos</span><span class="p">,</span> <span class="n">param</span><span class="p">,</span> <span class="n">grootpos</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Apply the transformations according to the parameter file.</span>

<span class="sd">	Does not delete the root node, which is a special case because if there is</span>
<span class="sd">	more than one child it cannot be deleted.</span>

<span class="sd">	:param pos: a list with the contents of tree.pos(); modified in-place.</span>
<span class="sd">	:param gpos: a dictionary of the POS tags of the original gold tree, before</span>
<span class="sd">		any tags/words have been deleted.</span>
<span class="sd">	:param param: the parameters specifying which labels / words to delete</span>
<span class="sd">	:param grootpos: the set of indices with preterminals directly under the</span>
<span class="sd">		root node of the gold tree.</span>
<span class="sd">	:returns: an immutable, transformed copy of ``tree``.&quot;&quot;&quot;</span>
	<span class="n">leaves</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">sent</span><span class="p">)))</span>
	<span class="n">posnodes</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">(</span>
			<span class="k">lambda</span> <span class="n">n</span><span class="p">:</span> <span class="n">n</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tree</span><span class="p">)))):</span>
		<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">count</span><span class="p">(),</span> <span class="n">a</span><span class="p">))[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
			<span class="n">b</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;EQ_LABEL&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">label</span><span class="p">,</span> <span class="n">b</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">b</span><span class="p">:</span>
				<span class="n">a</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>  <span class="c"># remove empty nodes</span>
			<span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tree</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">b</span><span class="o">.</span><span class="n">label</span> <span class="ow">in</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">]:</span>
					<span class="c"># replace phrasal node with its children</span>
					<span class="c"># (must remove nodes from b first because ParentedTree)</span>
					<span class="n">bnodes</span> <span class="o">=</span> <span class="n">b</span><span class="p">[:]</span>
					<span class="n">b</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[]</span>
					<span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">:</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">bnodes</span>
			<span class="k">elif</span> <span class="p">(</span><span class="n">gpos</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="ow">in</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_LABEL&#39;</span><span class="p">]</span>
					<span class="ow">or</span> <span class="n">sent</span><span class="p">[</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="ow">in</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_WORD&#39;</span><span class="p">]</span>
					<span class="ow">or</span> <span class="p">(</span><span class="n">param</span><span class="p">[</span><span class="s">&#39;DELETE_ROOT_PRETERMS&#39;</span><span class="p">]</span> <span class="ow">and</span> <span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">grootpos</span><span class="p">)):</span>
				<span class="c"># remove pre-terminal entirely, but only look at gold tree,</span>
				<span class="c"># to ensure the sentence lengths stay the same</span>
				<span class="n">leaves</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">b</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
				<span class="k">del</span> <span class="n">a</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">posnodes</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
	<span class="c"># retain words still in tree</span>
	<span class="n">sent</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sent</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">]</span>
	<span class="c"># drop indices from POS tags</span>
	<span class="n">pos</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">pos</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">]</span>
	<span class="c"># removed POS tags cause the numbering to be off, restore.</span>
	<span class="n">leafmap</span> <span class="o">=</span> <span class="p">{</span><span class="n">m</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">leaves</span><span class="p">)}</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">posnodes</span><span class="p">:</span>
		<span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">leafmap</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>
		<span class="k">if</span> <span class="n">sent</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="ow">in</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;EQ_WORD&#39;</span><span class="p">]:</span>
			<span class="n">sent</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">param</span><span class="p">[</span><span class="s">&#39;EQ_WORD&#39;</span><span class="p">][</span><span class="n">sent</span><span class="p">[</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
	<span class="k">return</span> <span class="n">tree</span><span class="o">.</span><span class="n">freeze</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="parentedbracketings"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.parentedbracketings">[docs]</a><span class="k">def</span> <span class="nf">parentedbracketings</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">labeled</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dellabel</span><span class="o">=</span><span class="p">(),</span> <span class="n">disconly</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Return the labeled bracketings with parents for a tree.</span>

<span class="sd">	:returns:</span>
<span class="sd">		multiset with items of the form ``((label, indices), parentlabel)``</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">Counter</span><span class="p">((</span><span class="n">bracketing</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">labeled</span><span class="p">),</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="s">&#39;label&#39;</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">))</span>
			<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">a</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tree</span><span class="p">)</span>  <span class="c"># nonempty, not a preterminal</span>
				<span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dellabel</span>
				<span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">disconly</span> <span class="ow">or</span> <span class="n">disc</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="bracketings"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.bracketings">[docs]</a><span class="k">def</span> <span class="nf">bracketings</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">labeled</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">dellabel</span><span class="o">=</span><span class="p">(),</span> <span class="n">disconly</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Return the labeled set of bracketings for a tree.</span>

<span class="sd">	For each nonterminal node, the set will contain a tuple with the label and</span>
<span class="sd">	the set of terminals which it dominates.</span>
<span class="sd">	``tree`` must have been processed by ``transform()``.</span>
<span class="sd">	The argument ``dellabel`` is only used to exclude the ROOT node from the</span>
<span class="sd">	results (because it cannot be deleted by ``transform()`` when non-unary).</span>

<span class="sd">	&gt;&gt;&gt; tree = Tree(&#39;(S (NP 1) (VP (VB 0) (JJ 2)))&#39;)</span>
<span class="sd">	&gt;&gt;&gt; params = {&#39;DELETE_LABEL&#39;: set(), &#39;DELETE_WORD&#39;: set(),</span>
<span class="sd">	... &#39;EQ_LABEL&#39;: {}, &#39;EQ_WORD&#39;: {},</span>
<span class="sd">	... &#39;DELETE_ROOT_PRETERMS&#39;: 0}</span>
<span class="sd">	&gt;&gt;&gt; tree = transform(tree, tree.leaves(), tree.pos(), dict(tree.pos()),</span>
<span class="sd">	... params, set())</span>
<span class="sd">	&gt;&gt;&gt; for (label, span), cnt in sorted(bracketings(tree).items()):</span>
<span class="sd">	...		print(label, bin(span), cnt)</span>
<span class="sd">	S 0b111 1</span>
<span class="sd">	VP 0b101 1</span>
<span class="sd">	&gt;&gt;&gt; tree = Tree(&#39;(S (NP 1) (VP (VB 0) (JJ 2)))&#39;)</span>
<span class="sd">	&gt;&gt;&gt; params[&#39;DELETE_LABEL&#39;] = {&#39;VP&#39;}</span>
<span class="sd">	&gt;&gt;&gt; tree = transform(tree, tree.leaves(), tree.pos(), dict(tree.pos()),</span>
<span class="sd">	... params, set())</span>
<span class="sd">	&gt;&gt;&gt; for (label, span), cnt in sorted(bracketings(tree).items()):</span>
<span class="sd">	...		print(label, bin(span), cnt)</span>
<span class="sd">	S 0b111 1&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">Counter</span><span class="p">(</span><span class="n">bracketing</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">labeled</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">()</span>
			<span class="k">if</span> <span class="n">a</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tree</span><span class="p">)</span>  <span class="c"># nonempty, not a preterminal</span>
				<span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dellabel</span> <span class="ow">and</span> <span class="p">(</span><span class="ow">not</span> <span class="n">disconly</span> <span class="ow">or</span> <span class="n">disc</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>

</div>
<div class="viewcode-block" id="bracketing"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.bracketing">[docs]</a><span class="k">def</span> <span class="nf">bracketing</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">labeled</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Generate bracketing ``(label, indices)`` for a given node.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">label</span> <span class="k">if</span> <span class="n">labeled</span> <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">node</span><span class="o">.</span><span class="n">bitset</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="strbracketings"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.strbracketings">[docs]</a><span class="k">def</span> <span class="nf">strbracketings</span><span class="p">(</span><span class="n">brackets</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Return a string with a concise representation of a bracketing.</span>

<span class="sd">	&gt;&gt;&gt; print(strbracketings({(&#39;S&#39;, 0b111), (&#39;VP&#39;, 0b101)}))</span>
<span class="sd">	S[0-2], VP[0,2]</span>
<span class="sd">	&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">brackets</span><span class="p">:</span>
		<span class="k">return</span> <span class="s">&#39;{}&#39;</span>
	<span class="k">return</span> <span class="s">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">[</span><span class="si">%s</span><span class="s">]&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
		<span class="s">&#39;-&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">y</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">x</span><span class="p">)))</span>
		<span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">intervals</span><span class="p">(</span><span class="n">b</span><span class="p">)))</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">brackets</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="leafancestorpaths"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.leafancestorpaths">[docs]</a><span class="k">def</span> <span class="nf">leafancestorpaths</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">dellabel</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Generate a list of ancestors for each leaf node in a tree.&quot;&quot;&quot;</span>
	<span class="c"># uses [] to mark components, and () to mark constituent boundaries</span>
	<span class="c"># deleted words/tags should not affect boundary detection</span>
	<span class="n">paths</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="p">[]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">getbits</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">bitset</span><span class="p">)}</span>
	<span class="c"># do a top-down level-order traversal</span>
	<span class="n">thislevel</span> <span class="o">=</span> <span class="p">[</span><span class="n">tree</span><span class="p">]</span>
	<span class="k">while</span> <span class="n">thislevel</span><span class="p">:</span>
		<span class="n">nextlevel</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">thislevel</span><span class="p">:</span>
			<span class="n">leaves</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">getbits</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">bitset</span><span class="p">))</span>
			<span class="c"># skip empty nodes and POS tags</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="n">leaves</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">n</span> <span class="ow">or</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">n</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tree</span><span class="p">)):</span>
				<span class="k">continue</span>
			<span class="n">first</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">leaves</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">leaves</span><span class="p">)</span>
			<span class="c"># skip root node if it is to be deleted</span>
			<span class="k">if</span> <span class="n">n</span><span class="o">.</span><span class="n">label</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dellabel</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
					<span class="c"># mark end of constituents / components</span>
					<span class="k">if</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">last</span> <span class="ow">and</span> <span class="s">&#39;)&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">[</span><span class="n">b</span><span class="p">]:</span>
							<span class="n">paths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">)</span>
						<span class="k">elif</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">last</span> <span class="ow">and</span> <span class="s">&#39;]&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">[</span><span class="n">b</span><span class="p">]:</span>
							<span class="n">paths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;]&#39;</span><span class="p">)</span>
					<span class="c"># add this label to the lineage</span>
					<span class="n">paths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">n</span><span class="o">.</span><span class="n">label</span><span class="p">)</span>
					<span class="c"># mark beginning of constituents / components</span>
					<span class="k">if</span> <span class="n">b</span> <span class="o">-</span> <span class="mi">1</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">leaves</span><span class="p">:</span>
						<span class="k">if</span> <span class="n">b</span> <span class="o">==</span> <span class="n">first</span> <span class="ow">and</span> <span class="s">&#39;(&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">[</span><span class="n">b</span><span class="p">]:</span>
							<span class="n">paths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">)</span>
						<span class="k">elif</span> <span class="n">b</span> <span class="o">!=</span> <span class="n">first</span> <span class="ow">and</span> <span class="s">&#39;[&#39;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">paths</span><span class="p">[</span><span class="n">b</span><span class="p">]:</span>
							<span class="n">paths</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;[&#39;</span><span class="p">)</span>
			<span class="n">nextlevel</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
		<span class="n">thislevel</span> <span class="o">=</span> <span class="n">nextlevel</span>
	<span class="k">return</span> <span class="n">paths</span>

</div>
<div class="viewcode-block" id="pathscore"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.pathscore">[docs]</a><span class="k">def</span> <span class="nf">pathscore</span><span class="p">(</span><span class="n">gold</span><span class="p">,</span> <span class="n">cand</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Get edit distance for two leaf-ancestor paths.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">Decimal</span><span class="p">(</span><span class="n">editdistance</span><span class="p">(</span><span class="n">cand</span><span class="p">,</span> <span class="n">gold</span><span class="p">))</span> <span class="o">/</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">gold</span> <span class="o">+</span> <span class="n">cand</span><span class="p">),</span> <span class="mi">1</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="leafancestor"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.leafancestor">[docs]</a><span class="k">def</span> <span class="nf">leafancestor</span><span class="p">(</span><span class="n">goldtree</span><span class="p">,</span> <span class="n">candtree</span><span class="p">,</span> <span class="n">dellabel</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Sampson, Babarcz (2003): A test of the leaf-ancestor metric [...].&quot;&quot;&quot;</span>
	<span class="n">gold</span> <span class="o">=</span> <span class="n">leafancestorpaths</span><span class="p">(</span><span class="n">goldtree</span><span class="p">,</span> <span class="n">dellabel</span><span class="p">)</span>
	<span class="n">cand</span> <span class="o">=</span> <span class="n">leafancestorpaths</span><span class="p">(</span><span class="n">candtree</span><span class="p">,</span> <span class="n">dellabel</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">mean</span><span class="p">([</span><span class="n">pathscore</span><span class="p">(</span><span class="n">gold</span><span class="p">[</span><span class="n">leaf</span><span class="p">],</span> <span class="n">cand</span><span class="p">[</span><span class="n">leaf</span><span class="p">])</span> <span class="k">for</span> <span class="n">leaf</span> <span class="ow">in</span> <span class="n">gold</span><span class="p">])</span>

</div>
<div class="viewcode-block" id="treedisteval"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.treedisteval">[docs]</a><span class="k">def</span> <span class="nf">treedisteval</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">includeroot</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">debug</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Get tree-distance for two trees and compute the Dice normalization.&quot;&quot;&quot;</span>
	<span class="n">ted</span> <span class="o">=</span> <span class="n">treedist</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">debug</span><span class="p">)</span>
	<span class="n">denom</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">subtrees</span><span class="p">())</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">b</span><span class="o">.</span><span class="n">subtrees</span><span class="p">()))</span>  <span class="c"># Dice denominator</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">includeroot</span><span class="p">:</span>  <span class="c"># optionally discount ROOT nodes and preterminals</span>
		<span class="n">denom</span> <span class="o">-=</span> <span class="mi">2</span>
	<span class="k">return</span> <span class="n">ted</span><span class="p">,</span> <span class="n">denom</span>


<span class="c"># If the goldfile contains n constituents for the same span, and the parsed</span>
<span class="c"># file contains m constituents with that nonterminal, the scorer works as</span>
<span class="c"># follows:</span>
<span class="c">#</span>
<span class="c"># i) If m&gt;n, then the precision is n/m, recall is 100%</span>
<span class="c"># ii) If n&gt;m, then the precision is 100%, recall is m/n.</span>
<span class="c"># iii) If n==m, recall and precision are both 100%.</span></div>
<div class="viewcode-block" id="recall"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.recall">[docs]</a><span class="k">def</span> <span class="nf">recall</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">candidate</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Get recall score for two multisets.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">reference</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;NaN&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">candidate</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
			<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">reference</span> <span class="o">&amp;</span> <span class="n">candidate</span><span class="p">))</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">reference</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="precision"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.precision">[docs]</a><span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">candidate</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Get precision score for two multisets.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">candidate</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;NaN&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">reference</span><span class="p">[</span><span class="n">a</span><span class="p">],</span> <span class="n">candidate</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
			<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">reference</span> <span class="o">&amp;</span> <span class="n">candidate</span><span class="p">))</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">candidate</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

</div>
<div class="viewcode-block" id="f_measure"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.f_measure">[docs]</a><span class="k">def</span> <span class="nf">f_measure</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">candidate</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">Decimal</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)):</span>
	<span class="sd">&quot;&quot;&quot;Get F-measure of precision and recall for two multisets.</span>

<span class="sd">	The default weight ``alpha=0.5`` corresponds to the F_1-measure.&quot;&quot;&quot;</span>
	<span class="n">p</span> <span class="o">=</span> <span class="n">precision</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">candidate</span><span class="p">)</span>
	<span class="n">r</span> <span class="o">=</span> <span class="n">recall</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">candidate</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">p</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">r</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;NaN&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">alpha</span> <span class="o">/</span> <span class="n">p</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">alpha</span><span class="p">)</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="accuracy"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.accuracy">[docs]</a><span class="k">def</span> <span class="nf">accuracy</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">candidate</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Compute fraction of equivalent pairs in two sequences.</span>

<span class="sd">	In particular, return the fraction of indices</span>
<span class="sd">	``0&lt;i&lt;=len(test)`` such that ``test[i] == reference[i]``.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate</span><span class="p">):</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Sequences must have the same length.&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="mi">1</span> <span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">reference</span><span class="p">,</span> <span class="n">candidate</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">a</span> <span class="o">==</span> <span class="n">b</span><span class="p">))</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">reference</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="harmean"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.harmean">[docs]</a><span class="k">def</span> <span class="nf">harmean</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Compute harmonic mean of a sequence of numbers.</span>

<span class="sd">	Returns NaN when ``seq`` contains zero.&quot;&quot;&quot;</span>
	<span class="n">numerator</span> <span class="o">=</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">a</span><span class="p">:</span>
			<span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;NaN&#39;</span><span class="p">)</span>
		<span class="n">numerator</span> <span class="o">+=</span> <span class="mi">1</span>
		<span class="n">denominator</span> <span class="o">+=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">a</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">denominator</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;NaN&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>

</div>
<div class="viewcode-block" id="mean"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.mean">[docs]</a><span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">seq</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Compute arithmetic mean of a sequence.</span>

<span class="sd">	Returns NaN when ``seq`` is empty.&quot;&quot;&quot;</span>
	<span class="n">numerator</span> <span class="o">=</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">Decimal</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">seq</span><span class="p">:</span>
		<span class="n">numerator</span> <span class="o">+=</span> <span class="n">a</span>
		<span class="n">denominator</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">denominator</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">Decimal</span><span class="p">(</span><span class="s">&#39;NaN&#39;</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span>

</div>
<div class="viewcode-block" id="intervals"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.intervals">[docs]</a><span class="k">def</span> <span class="nf">intervals</span><span class="p">(</span><span class="n">bitset</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Return a sequence of intervals corresponding to contiguous ranges.</span>

<span class="sd">	``seq`` is an integer representing a bitvector. An interval is a pair</span>
<span class="sd">	``(a, b)``, with ``a &lt;= b`` denoting a contiguous range of one bits ``x``</span>
<span class="sd">	in ``seq`` such that ``a &lt;= x &lt;= b``.</span>

<span class="sd">	&gt;&gt;&gt; list(intervals(0b111011011))  # NB: read from right to left</span>
<span class="sd">	[(0, 1), (3, 4), (6, 8)]&quot;&quot;&quot;</span>
	<span class="n">start</span> <span class="o">=</span> <span class="n">prev</span> <span class="o">=</span> <span class="bp">None</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">getbits</span><span class="p">(</span><span class="n">bitset</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">start</span> <span class="o">=</span> <span class="n">prev</span> <span class="o">=</span> <span class="n">a</span>
		<span class="k">elif</span> <span class="n">a</span> <span class="o">==</span> <span class="n">prev</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">prev</span> <span class="o">=</span> <span class="n">a</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">yield</span> <span class="n">start</span><span class="p">,</span> <span class="n">prev</span>
			<span class="n">start</span> <span class="o">=</span> <span class="n">prev</span> <span class="o">=</span> <span class="n">a</span>
	<span class="k">if</span> <span class="n">start</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
		<span class="k">yield</span> <span class="n">start</span><span class="p">,</span> <span class="n">prev</span>

</div>
<div class="viewcode-block" id="nozerodiv"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.nozerodiv">[docs]</a><span class="k">def</span> <span class="nf">nozerodiv</span><span class="p">(</span><span class="n">func</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Return ``func()`` as 6-character string but catch zero division.&quot;&quot;&quot;</span>
	<span class="k">try</span><span class="p">:</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">func</span><span class="p">()</span>
	<span class="k">except</span> <span class="p">(</span><span class="ne">ZeroDivisionError</span><span class="p">,</span> <span class="n">InvalidOperation</span><span class="p">):</span>
		<span class="k">return</span> <span class="s">&#39; 0DIV!&#39;</span>
	<span class="k">return</span> <span class="s">&#39;  None&#39;</span> <span class="k">if</span> <span class="n">result</span> <span class="ow">is</span> <span class="bp">None</span> <span class="k">else</span> <span class="s">&#39;</span><span class="si">%6.2f</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">100</span> <span class="o">*</span> <span class="n">result</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="editdistance"><a class="viewcode-back" href="../../api/discodop.eval.html#discodop.eval.editdistance">[docs]</a><span class="k">def</span> <span class="nf">editdistance</span><span class="p">(</span><span class="n">seq1</span><span class="p">,</span> <span class="n">seq2</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Calculate the Levenshtein edit-distance between two strings.</span>

<span class="sd">	The edit distance is the number of characters that need to be substituted,</span>
<span class="sd">	inserted, or deleted, to transform seq1 into seq2.  For example,</span>
<span class="sd">	transforming &#39;rain&#39; to &#39;shine&#39; requires three steps, consisting of two</span>
<span class="sd">	substitutions and one insertion: &#39;rain&#39; -&gt; &#39;sain&#39; -&gt; &#39;shin&#39; -&gt; &#39;shine&#39;.</span>
<span class="sd">	These operations could have been done in other orders, but at least three</span>
<span class="sd">	steps are needed.&quot;&quot;&quot;</span>
	<span class="c"># initialize 2-D array to zero</span>
	<span class="n">len1</span><span class="p">,</span> <span class="n">len2</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq1</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">seq2</span><span class="p">)</span>
	<span class="n">lev</span> <span class="o">=</span> <span class="p">[[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">len2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len1</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
		<span class="n">lev</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span>           <span class="c"># column 0: 0,1,2,3,4,...</span>
	<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len2</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
		<span class="n">lev</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span>           <span class="c"># row 0: 0,1,2,3,4,...</span>
	<span class="c"># iterate over the array</span>
	<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len1</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">len2</span><span class="p">):</span>
			<span class="n">a</span> <span class="o">=</span> <span class="n">lev</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>               <span class="c"># skip seq1[i]</span>
			<span class="n">b</span> <span class="o">=</span> <span class="n">lev</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">seq1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">!=</span> <span class="n">seq2</span><span class="p">[</span><span class="n">j</span><span class="p">])</span>  <span class="c"># match seq1[i] with seq2[j]</span>
			<span class="n">c</span> <span class="o">=</span> <span class="n">lev</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>               <span class="c"># skip seq2[j]</span>
			<span class="n">lev</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">][</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">)</span>    <span class="c"># pick the cheapest</span>
	<span class="k">return</span> <span class="n">lev</span><span class="p">[</span><span class="n">len1</span><span class="p">][</span><span class="n">len2</span><span class="p">]</span>

</div>
<span class="k">def</span> <span class="nf">pyintbitcount</span><span class="p">(</span><span class="n">a</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Return number of set bits (1s) in a Python integer.</span>

<span class="sd">	&gt;&gt;&gt; pyintbitcount(0b0011101)</span>
<span class="sd">	4&quot;&quot;&quot;</span>
	<span class="n">cnt</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="k">while</span> <span class="n">a</span><span class="p">:</span>
		<span class="n">a</span> <span class="o">&amp;=</span> <span class="n">a</span> <span class="o">-</span> <span class="mi">1</span>
		<span class="n">cnt</span> <span class="o">+=</span> <span class="mi">1</span>
	<span class="k">return</span> <span class="n">cnt</span>


<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Evaluator&#39;</span><span class="p">,</span> <span class="s">&#39;TreePairResult&#39;</span><span class="p">,</span> <span class="s">&#39;EvalAccumulator&#39;</span><span class="p">,</span> <span class="s">&#39;main&#39;</span><span class="p">,</span>
		<span class="s">&#39;readparam&#39;</span><span class="p">,</span> <span class="s">&#39;transitiveclosure&#39;</span><span class="p">,</span> <span class="s">&#39;alignsent&#39;</span><span class="p">,</span> <span class="s">&#39;transform&#39;</span><span class="p">,</span>
		<span class="s">&#39;parentedbracketings&#39;</span><span class="p">,</span> <span class="s">&#39;bracketings&#39;</span><span class="p">,</span> <span class="s">&#39;bracketing&#39;</span><span class="p">,</span> <span class="s">&#39;strbracketings&#39;</span><span class="p">,</span>
		<span class="s">&#39;leafancestorpaths&#39;</span><span class="p">,</span> <span class="s">&#39;pathscore&#39;</span><span class="p">,</span> <span class="s">&#39;leafancestor&#39;</span><span class="p">,</span> <span class="s">&#39;treedisteval&#39;</span><span class="p">,</span>
		<span class="s">&#39;recall&#39;</span><span class="p">,</span> <span class="s">&#39;precision&#39;</span><span class="p">,</span> <span class="s">&#39;f_measure&#39;</span><span class="p">,</span> <span class="s">&#39;accuracy&#39;</span><span class="p">,</span> <span class="s">&#39;harmean&#39;</span><span class="p">,</span> <span class="s">&#39;mean&#39;</span><span class="p">,</span>
		<span class="s">&#39;intervals&#39;</span><span class="p">,</span> <span class="s">&#39;disc&#39;</span><span class="p">,</span> <span class="s">&#39;nozerodiv&#39;</span><span class="p">,</span> <span class="s">&#39;editdistance&#39;</span><span class="p">]</span>

<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
	<span class="n">main</span><span class="p">()</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html#overview">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ref.html">Reference</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../index.html">Disco-DOP 0.5pre1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2014, Andreas van Cranenburgh.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>