<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>discodop.treebank &mdash; Disco-DOP 0.5pre1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.5pre1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="Disco-DOP 0.5pre1 documentation" href="../../index.html" />
    <link rel="up" title="Module code" href="../index.html" /> 
  </head>
  <body role="document">
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../index.html">Disco-DOP 0.5pre1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for discodop.treebank</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot;Read and write treebanks.&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">division</span><span class="p">,</span> <span class="n">print_function</span><span class="p">,</span> <span class="n">absolute_import</span><span class="p">,</span> \
		<span class="n">unicode_literals</span>
<span class="kn">import</span> <span class="nn">io</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">re</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">import</span> <span class="nn">gzip</span>
<span class="kn">import</span> <span class="nn">codecs</span>
<span class="kn">import</span> <span class="nn">xml.etree.cElementTree</span> <span class="kn">as</span> <span class="nn">ElementTree</span>
<span class="kn">from</span> <span class="nn">glob</span> <span class="kn">import</span> <span class="n">glob</span>
<span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">count</span><span class="p">,</span> <span class="n">chain</span><span class="p">,</span> <span class="n">islice</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
<span class="k">try</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">cyordereddict</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
	<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>
<span class="kn">from</span> <span class="nn">discodop.tree</span> <span class="kn">import</span> <span class="n">Tree</span><span class="p">,</span> <span class="n">ParentedTree</span>
<span class="kn">from</span> <span class="nn">discodop.punctuation</span> <span class="kn">import</span> <span class="n">applypunct</span>
<span class="kn">from</span> <span class="nn">discodop.heads</span> <span class="kn">import</span> <span class="n">applyheadrules</span><span class="p">,</span> <span class="n">readheadrules</span><span class="p">,</span> <span class="n">ishead</span>

<span class="n">FIELDS</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
<span class="n">WORD</span><span class="p">,</span> <span class="n">LEMMA</span><span class="p">,</span> <span class="n">TAG</span><span class="p">,</span> <span class="n">MORPH</span><span class="p">,</span> <span class="n">FUNC</span><span class="p">,</span> <span class="n">PARENT</span> <span class="o">=</span> <span class="n">FIELDS</span>
<span class="n">EXPORTHEADER</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%%</span><span class="s"> word</span><span class="se">\t</span><span class="s">lemma</span><span class="se">\t</span><span class="s">tag</span><span class="se">\t</span><span class="s">morph</span><span class="se">\t</span><span class="s">edge</span><span class="se">\t</span><span class="s">parent</span><span class="se">\t</span><span class="s">secedge</span><span class="se">\n</span><span class="s">&#39;</span>
<span class="n">EXPORTNONTERMINAL</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;^#([5-9][0-9][0-9])$&#39;</span><span class="p">)</span>
<span class="n">POSRE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\(([^() ]+) [^ ()]+\)&#39;</span><span class="p">)</span>
<span class="n">TERMINALSRE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39; ([^ ()]+)\)&#39;</span><span class="p">)</span>
<span class="n">LEAVESRE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39; ([^ ()]*)\)&#39;</span><span class="p">)</span>
<span class="n">FRONTIERNTRE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39; \)&#39;</span><span class="p">)</span>
<span class="n">INDEXRE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39; [0-9]+\)&#39;</span><span class="p">)</span>
<span class="n">SUPERFLUOUSSPACERE</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;\)\s+(?=\))&#39;</span><span class="p">)</span>


<div class="viewcode-block" id="Item"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.Item">[docs]</a><span class="k">class</span> <span class="nc">Item</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;A treebank item.&quot;&quot;&quot;</span>
	<span class="n">__slots__</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;tree&#39;</span><span class="p">,</span> <span class="s">&#39;sent&#39;</span><span class="p">,</span> <span class="s">&#39;comment&#39;</span><span class="p">,</span> <span class="s">&#39;block&#39;</span><span class="p">)</span>

	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">tree</span>  <span class="c"># A ParentedTree</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">sent</span> <span class="o">=</span> <span class="n">sent</span>  <span class="c"># list of str</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span>  <span class="c"># a string or None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">block</span>  <span class="c"># a string with tree in original treebank format</span>

</div>
<div class="viewcode-block" id="CorpusReader"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.CorpusReader">[docs]</a><span class="k">class</span> <span class="nc">CorpusReader</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Abstract corpus reader.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">ensureroot</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">punct</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
			<span class="n">headrules</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">removeempty</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
			<span class="n">functions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lemmas</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		:param path: filename or pattern of corpus files; e.g., ``wsj*.mrg``.</span>
<span class="sd">		:param ensureroot: add root node with given label if necessary.</span>
<span class="sd">		:param removeempty: remove empty nodes and any empty ancestors; a</span>
<span class="sd">			terminal is empty if it is equal to None, &#39;&#39;, or &#39;-NONE-&#39;.</span>
<span class="sd">		:param headrules: if given, read rules for assigning heads and apply</span>
<span class="sd">			them by ordering constituents according to their heads.</span>
<span class="sd">		:param punct: one of ...</span>

<span class="sd">			:None: leave punctuation as is [default].</span>
<span class="sd">			:&#39;move&#39;: move punctuation to appropriate constituents</span>
<span class="sd">					using heuristics.</span>
<span class="sd">			:&#39;moveall&#39;: same as &#39;move&#39;, but moves all preterminals under root,</span>
<span class="sd">					instead of only recognized punctuation.</span>
<span class="sd">			:&#39;prune&#39;: prune away leading &amp; ending quotes &amp; periods, then move.</span>
<span class="sd">			:&#39;remove&#39;: eliminate punctuation.</span>
<span class="sd">			:&#39;root&#39;: attach punctuation directly to root</span>
<span class="sd">					(as in original Negra/Tiger treebanks).</span>
<span class="sd">		:param functions: one of ...</span>

<span class="sd">			:None, &#39;leave&#39;: leave syntactic labels as is [default].</span>
<span class="sd">			:&#39;add&#39;: concatenate grammatical function to syntactic label,</span>
<span class="sd">				separated by a hypen: e.g., ``NP =&gt; NP-SBJ``.</span>
<span class="sd">			:&#39;remove&#39;: strip away hyphen-separated grammatical function,</span>
<span class="sd">				e.g., ``NP-SBJ =&gt; NP``.</span>
<span class="sd">			:&#39;replace&#39;: replace syntactic label with grammatical function,</span>
<span class="sd">				e.g., ``NP =&gt; SBJ``.</span>
<span class="sd">		:param morphology: one of ...</span>

<span class="sd">			:None, &#39;no&#39;: use POS tags as preterminals [default].</span>
<span class="sd">			:&#39;add&#39;: concatenate morphological information to POS tags,</span>
<span class="sd">				e.g., ``DET/sg.def``.</span>
<span class="sd">			:&#39;replace&#39;: use morphological information as preterminal label</span>
<span class="sd">			:&#39;between&#39;: add node with morphological information between</span>
<span class="sd">				POS tag and word, e.g., ``(DET (sg.def the))``.</span>
<span class="sd">		:param lemmas: one of ...</span>

<span class="sd">			:None: ignore lemmas [default].</span>
<span class="sd">			:&#39;add&#39;: concatenate lemma to terminals, e.g., men/man.</span>
<span class="sd">			:&#39;replace&#39;: use lemmas as terminals.</span>
<span class="sd">			:&#39;between&#39;: insert lemma as node between POS tag and word.&quot;&quot;&quot;</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">removeempty</span> <span class="o">=</span> <span class="n">removeempty</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">ensureroot</span> <span class="o">=</span> <span class="n">ensureroot</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="o">=</span> <span class="n">functions</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">punct</span> <span class="o">=</span> <span class="n">punct</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">morphology</span> <span class="o">=</span> <span class="n">morphology</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">lemmas</span> <span class="o">=</span> <span class="n">lemmas</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">headrules</span> <span class="o">=</span> <span class="n">readheadrules</span><span class="p">(</span><span class="n">headrules</span><span class="p">)</span> <span class="k">if</span> <span class="n">headrules</span> <span class="k">else</span> <span class="p">{}</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span> <span class="o">=</span> <span class="n">encoding</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span> <span class="o">=</span> <span class="p">(</span><span class="nb">sorted</span><span class="p">(</span><span class="n">glob</span><span class="p">(</span><span class="n">path</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="n">numbase</span><span class="p">)</span>
					<span class="k">if</span> <span class="n">path</span> <span class="o">!=</span> <span class="s">&#39;-&#39;</span> <span class="k">else</span> <span class="p">[</span><span class="s">&#39;-&#39;</span><span class="p">])</span>
		<span class="k">except</span> <span class="ne">TypeError</span><span class="p">:</span>
			<span class="k">print</span><span class="p">(</span><span class="s">&#39;all sentence IDs must have the same type signature &#39;</span>
					<span class="s">&#39;(number, string)&#39;</span><span class="p">)</span>
			<span class="k">raise</span>
		<span class="k">for</span> <span class="n">opts</span><span class="p">,</span> <span class="n">opt</span> <span class="ow">in</span> <span class="p">(</span>
				<span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;leave&#39;</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="s">&#39;remove&#39;</span><span class="p">,</span> <span class="s">&#39;between&#39;</span><span class="p">),</span>
					<span class="n">functions</span><span class="p">),</span>
				<span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="s">&#39;between&#39;</span><span class="p">),</span> <span class="n">morphology</span><span class="p">),</span>
				<span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">,</span> <span class="s">&#39;move&#39;</span><span class="p">,</span> <span class="s">&#39;moveall&#39;</span><span class="p">,</span> <span class="s">&#39;remove&#39;</span><span class="p">,</span> <span class="s">&#39;prune&#39;</span><span class="p">,</span> <span class="s">&#39;root&#39;</span><span class="p">),</span>
					<span class="n">punct</span><span class="p">),</span>
				<span class="p">((</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">,</span> <span class="s">&#39;add&#39;</span><span class="p">,</span> <span class="s">&#39;replace&#39;</span><span class="p">,</span> <span class="s">&#39;between&#39;</span><span class="p">),</span> <span class="n">lemmas</span><span class="p">),</span>
				<span class="p">):</span>
			<span class="k">if</span> <span class="n">opt</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">opts</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Expected one of </span><span class="si">%r</span><span class="s">. Got: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">opts</span><span class="p">,</span> <span class="n">opt</span><span class="p">))</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;no files matched pattern &#39;</span><span class="si">%s</span><span class="s">&#39; in </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">path</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()))</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_block_cache</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="bp">self</span><span class="o">.</span><span class="n">_trees_cache</span> <span class="o">=</span> <span class="bp">None</span>

<div class="viewcode-block" id="CorpusReader.itertrees"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.CorpusReader.itertrees">[docs]</a>	<span class="k">def</span> <span class="nf">itertrees</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">start</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		:returns: an iterator returning tuples ``(key, (tree, sent, comment))``</span>
<span class="sd">			of sentences in corpus. Useful when the dictionary of all trees in</span>
<span class="sd">			corpus would not fit in memory.&quot;&quot;&quot;</span>
		<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">islice</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_blocks</span><span class="p">(),</span> <span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">):</span>
			<span class="k">yield</span> <span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsetree</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="CorpusReader.trees"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.CorpusReader.trees">[docs]</a>	<span class="k">def</span> <span class="nf">trees</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		:returns: an ordered dictionary of parse trees</span>
<span class="sd">			(``Tree`` objects with integer indices as leaves).&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trees_cache</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_trees_cache</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsetree</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
					<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_blocks</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">tree</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trees_cache</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="CorpusReader.sents"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.CorpusReader.sents">[docs]</a>	<span class="k">def</span> <span class="nf">sents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		:returns: an ordered dictionary of sentences,</span>
<span class="sd">			each sentence being a list of words.&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trees_cache</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_trees_cache</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsetree</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
					<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_blocks</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">sent</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trees_cache</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="CorpusReader.tagged_sents"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.CorpusReader.tagged_sents">[docs]</a>	<span class="k">def</span> <span class="nf">tagged_sents</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		:returns: an ordered dictionary of tagged sentences,</span>
<span class="sd">			each tagged sentence being a list of (word, tag) pairs.&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trees_cache</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_trees_cache</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsetree</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
					<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_read_blocks</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(</span>
				<span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="p">[(</span><span class="n">w</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">w</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">sent</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">pos</span><span class="p">()))])</span>
				<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_trees_cache</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</div>
<div class="viewcode-block" id="CorpusReader.blocks"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.CorpusReader.blocks">[docs]</a>	<span class="k">def</span> <span class="nf">blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		:returns: a list of strings containing the raw representation of</span>
<span class="sd">			trees in the original treebank.&quot;&quot;&quot;</span>
</div>
	<span class="k">def</span> <span class="nf">_read_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Iterate over blocks in corpus file corresponding to parse trees.&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;:returns: a parse tree given a string from the treebank file.&quot;&quot;&quot;</span>

	<span class="k">def</span> <span class="nf">_parsetree</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;:returns: a transformed parse tree and sentence.&quot;&quot;&quot;</span>
		<span class="n">item</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">item</span><span class="o">.</span><span class="n">sent</span><span class="p">:</span>  <span class="c"># ??3</span>
			<span class="k">return</span> <span class="n">item</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">removeempty</span><span class="p">:</span>
			<span class="n">removeemptynodes</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">sent</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensureroot</span> <span class="ow">and</span> <span class="n">item</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">label</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ensureroot</span><span class="p">:</span>
			<span class="n">item</span><span class="o">.</span><span class="n">tree</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ensureroot</span><span class="p">,</span> <span class="p">[</span><span class="n">item</span><span class="o">.</span><span class="n">tree</span><span class="p">])</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">BracketCorpusReader</span><span class="p">):</span>
			<span class="c"># roughly order constituents by order in sentence</span>
			<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">))):</span>
				<span class="n">a</span><span class="o">.</span><span class="n">children</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">key</span><span class="o">=</span><span class="n">Tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">punct</span><span class="p">:</span>
			<span class="n">applypunct</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">punct</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">sent</span><span class="p">)</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">headrules</span><span class="p">:</span>
			<span class="n">applyheadrules</span><span class="p">(</span><span class="n">item</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headrules</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">item</span>

	<span class="k">def</span> <span class="nf">_word</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;:returns: a list of words given a string.&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">punct</span> <span class="ow">in</span> <span class="p">{</span><span class="s">&#39;remove&#39;</span><span class="p">,</span> <span class="s">&#39;prune&#39;</span><span class="p">}:</span>
			<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parsetree</span><span class="p">(</span><span class="n">block</span><span class="p">)</span><span class="o">.</span><span class="n">sent</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_parse</span><span class="p">(</span><span class="n">block</span><span class="p">)</span><span class="o">.</span><span class="n">sent</span>

</div>
<div class="viewcode-block" id="BracketCorpusReader"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.BracketCorpusReader">[docs]</a><span class="k">class</span> <span class="nc">BracketCorpusReader</span><span class="p">(</span><span class="n">CorpusReader</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Corpus reader for phrase-structures in bracket notation.</span>

<span class="sd">	For example::</span>

<span class="sd">		(S (NP John) (VP (VB is) (JJ rich)) (. .))&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_blocks</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">_read_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="n">line</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">openread</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">line</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
			<span class="k">yield</span> <span class="n">n</span><span class="p">,</span> <span class="n">block</span>

	<span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
		<span class="n">c</span> <span class="o">=</span> <span class="n">count</span><span class="p">()</span>
		<span class="n">block</span> <span class="o">=</span> <span class="n">SUPERFLUOUSSPACERE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>
		<span class="n">tree</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="p">(</span><span class="n">LEAVESRE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="s">&#39; </span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">c</span><span class="p">),</span> <span class="n">block</span><span class="p">))</span>
		<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">():</span>
			<span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="s">&#39;-=&#39;</span><span class="p">:</span>  <span class="c"># map NP-SUBJ and NP=2 to NP; don&#39;t touch -NONE-</span>
				<span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">char</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">isdigit</span><span class="p">():</span>
						<span class="k">if</span> <span class="n">a</span><span class="o">.</span><span class="n">source</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
							<span class="n">a</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="bp">None</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">FIELDS</span><span class="p">)</span>
						<span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">FUNC</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="p">[</span><span class="n">x</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;=0123456789&#39;</span><span class="p">)</span>
					<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span> <span class="o">==</span> <span class="s">&#39;remove&#39;</span><span class="p">:</span>
						<span class="n">a</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="p">[:</span><span class="n">x</span><span class="p">]</span>
		<span class="n">sent</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="ow">or</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">LEAVESRE</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">block</span><span class="p">)]</span>
		<span class="k">return</span> <span class="n">Item</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="DiscBracketCorpusReader"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.DiscBracketCorpusReader">[docs]</a><span class="k">class</span> <span class="nc">DiscBracketCorpusReader</span><span class="p">(</span><span class="n">CorpusReader</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;A corpus reader for discontinuous trees in bracket notation.</span>

<span class="sd">	Leaves are indices pointing to words in a separately specified sentence.</span>
<span class="sd">	For example::</span>

<span class="sd">		(S (NP 1) (VP (VB 0) (JJ 2)) (? 3))	is John rich ?</span>

<span class="sd">	Note that the tree and the sentence are separated by a tab, while the words</span>
<span class="sd">	in the sentence are separated by spaces. There is one tree and sentence</span>
<span class="sd">	per line. Compared to Negra&#39;s export format, this format lacks morphology,</span>
<span class="sd">	lemmas and functional edges. On the other hand, it is very close to the</span>
<span class="sd">	internal representation employed here, so it can be read efficiently.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_blocks</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">_read_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">block</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">((</span><span class="n">line</span> <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span>
				<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">openread</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">line</span><span class="p">),</span> <span class="mi">1</span><span class="p">):</span>
			<span class="k">yield</span> <span class="n">n</span><span class="p">,</span> <span class="n">block</span>

	<span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
		<span class="k">if</span> <span class="n">block</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
			<span class="n">treestr</span><span class="p">,</span> <span class="n">sent</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\r</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
			<span class="n">comment</span> <span class="o">=</span> <span class="bp">None</span>
		<span class="k">elif</span> <span class="n">block</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">:</span>
			<span class="n">treestr</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">comment</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\r</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Expected tree and sentence separated by tab.&#39;</span><span class="p">)</span>
		<span class="n">tree</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="p">(</span><span class="n">treestr</span><span class="p">)</span>
		<span class="n">sent</span> <span class="o">=</span> <span class="p">[</span><span class="n">unquote</span><span class="p">(</span><span class="n">word</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sent</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)]</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">(</span><span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">n</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">()):</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;All leaves must be in the interval 0..n with &#39;</span>
					<span class="s">&#39;n=len(sent)</span><span class="se">\n</span><span class="s">tokens: </span><span class="si">%d</span><span class="s"> indices: </span><span class="si">%r</span><span class="se">\n</span><span class="s">sent: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="nb">len</span><span class="p">(</span><span class="n">sent</span><span class="p">),</span> <span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">(),</span> <span class="n">sent</span><span class="p">))</span>
		<span class="k">return</span> <span class="n">Item</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">block</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="NegraCorpusReader"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.NegraCorpusReader">[docs]</a><span class="k">class</span> <span class="nc">NegraCorpusReader</span><span class="p">(</span><span class="n">CorpusReader</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Read a corpus in the Negra export format.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_cache</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_block_cache</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_blocks</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">a</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
				<span class="k">for</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_cache</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>

	<span class="k">def</span> <span class="nf">_read_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Read corpus and yield blocks corresponding to each sentence.&quot;&quot;&quot;</span>
		<span class="n">results</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
		<span class="n">started</span> <span class="o">=</span> <span class="bp">False</span>
		<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">openread</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span><span class="p">):</span>
				<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#BOS &#39;</span><span class="p">):</span>
					<span class="k">if</span> <span class="n">started</span><span class="p">:</span>
						<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;beginning of sentence marker while &#39;</span>
								<span class="s">&#39;previous one still open: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">line</span><span class="p">)</span>
					<span class="n">started</span> <span class="o">=</span> <span class="bp">True</span>
					<span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
					<span class="n">sentid</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
					<span class="n">lines</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>
				<span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#EOS &#39;</span><span class="p">):</span>
					<span class="k">if</span> <span class="ow">not</span> <span class="n">started</span><span class="p">:</span>
						<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;end of sentence marker while &#39;</span>
								<span class="s">&#39;none started&#39;</span><span class="p">)</span>
					<span class="n">thissentid</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">()[</span><span class="mi">1</span><span class="p">]</span>
					<span class="k">if</span> <span class="n">sentid</span> <span class="o">!=</span> <span class="n">thissentid</span><span class="p">:</span>
						<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unexpected sentence id: &#39;</span>
							<span class="s">&#39;start=</span><span class="si">%s</span><span class="s">, end=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">sentid</span><span class="p">,</span> <span class="n">thissentid</span><span class="p">))</span>
					<span class="n">started</span> <span class="o">=</span> <span class="bp">False</span>
					<span class="k">if</span> <span class="n">sentid</span> <span class="ow">in</span> <span class="n">results</span><span class="p">:</span>
						<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;duplicate sentence ID: </span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">sentid</span><span class="p">)</span>
					<span class="n">results</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">sentid</span><span class="p">)</span>
					<span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
					<span class="k">yield</span> <span class="n">sentid</span><span class="p">,</span> <span class="n">lines</span>
				<span class="k">elif</span> <span class="n">started</span><span class="p">:</span>
					<span class="n">lines</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
				<span class="c"># other lines are ignored, such as #FORMAT x, %% comments, ...</span>

	<span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">exporttree</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lemmas</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="TigerXMLCorpusReader"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.TigerXMLCorpusReader">[docs]</a><span class="k">class</span> <span class="nc">TigerXMLCorpusReader</span><span class="p">(</span><span class="n">CorpusReader</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Corpus reader for the Tiger XML format.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="TigerXMLCorpusReader.blocks"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.TigerXMLCorpusReader.blocks">[docs]</a>	<span class="k">def</span> <span class="nf">blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		:returns: a list of strings containing the raw representation of</span>
<span class="sd">			trees in the treebank.&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_cache</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_block_cache</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_blocks</span><span class="p">())</span>
		<span class="k">return</span> <span class="n">OrderedDict</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
				<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_cache</span><span class="o">.</span><span class="n">items</span><span class="p">())</span>
</div>
	<span class="k">def</span> <span class="nf">_read_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">:</span>
			<span class="c"># iterator over elements in XML  file</span>
			<span class="n">context</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">iterparse</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span>
					<span class="n">events</span><span class="o">=</span><span class="p">(</span><span class="s">&#39;start&#39;</span><span class="p">,</span> <span class="s">&#39;end&#39;</span><span class="p">))</span>
			<span class="n">_</span><span class="p">,</span> <span class="n">root</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">context</span><span class="p">)</span>  <span class="c"># event == &#39;start&#39; of root element</span>
			<span class="k">for</span> <span class="n">event</span><span class="p">,</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">context</span><span class="p">:</span>
				<span class="k">if</span> <span class="n">event</span> <span class="o">==</span> <span class="s">&#39;end&#39;</span> <span class="ow">and</span> <span class="n">elem</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;s&#39;</span><span class="p">:</span>
					<span class="k">yield</span> <span class="n">elem</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">),</span> <span class="n">elem</span>
				<span class="n">root</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>

	<span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Translate Tiger XML structure to the fields of export format.&quot;&quot;&quot;</span>
		<span class="n">nodes</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
		<span class="n">root</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;graph&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;root&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">term</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;graph&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;terminals&#39;</span><span class="p">):</span>
			<span class="n">fields</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">term</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">),</span> <span class="mi">6</span> <span class="o">*</span> <span class="p">[</span><span class="bp">None</span><span class="p">])</span>
			<span class="n">fields</span><span class="p">[</span><span class="n">WORD</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;word&#39;</span><span class="p">)</span>
			<span class="n">fields</span><span class="p">[</span><span class="n">LEMMA</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;lemma&#39;</span><span class="p">)</span>
			<span class="n">fields</span><span class="p">[</span><span class="n">TAG</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pos&#39;</span><span class="p">)</span>
			<span class="n">fields</span><span class="p">[</span><span class="n">MORPH</span><span class="p">]</span> <span class="o">=</span> <span class="n">term</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;morph&#39;</span><span class="p">)</span>
			<span class="n">fields</span><span class="p">[</span><span class="n">PARENT</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span> <span class="k">if</span> <span class="n">term</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">root</span> <span class="k">else</span> <span class="bp">None</span>
			<span class="n">nodes</span><span class="p">[</span><span class="n">term</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">fields</span>
		<span class="k">for</span> <span class="n">nt</span> <span class="ow">in</span> <span class="n">block</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;graph&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;nonterminals&#39;</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">nt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span> <span class="o">==</span> <span class="n">root</span><span class="p">:</span>
				<span class="n">ntid</span> <span class="o">=</span> <span class="s">&#39;0&#39;</span>
			<span class="k">else</span><span class="p">:</span>
				<span class="n">fields</span> <span class="o">=</span> <span class="n">nodes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">nt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">),</span> <span class="mi">6</span> <span class="o">*</span> <span class="p">[</span><span class="bp">None</span><span class="p">])</span>
				<span class="n">ntid</span> <span class="o">=</span> <span class="n">nt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
				<span class="n">fields</span><span class="p">[</span><span class="n">WORD</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;#&#39;</span> <span class="o">+</span> <span class="n">ntid</span>
				<span class="n">fields</span><span class="p">[</span><span class="n">TAG</span><span class="p">]</span> <span class="o">=</span> <span class="n">nt</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cat&#39;</span><span class="p">)</span>
				<span class="n">fields</span><span class="p">[</span><span class="n">LEMMA</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">MORPH</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;--&#39;</span>
			<span class="k">for</span> <span class="n">edge</span> <span class="ow">in</span> <span class="n">nt</span><span class="p">:</span>
				<span class="n">idref</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;idref&#39;</span><span class="p">)</span>
				<span class="n">nodes</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">idref</span><span class="p">,</span> <span class="mi">6</span> <span class="o">*</span> <span class="p">[</span><span class="bp">None</span><span class="p">])</span>
				<span class="k">if</span> <span class="n">edge</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;edge&#39;</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">idref</span><span class="p">][</span><span class="n">FUNC</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
						<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> already has a parent: </span><span class="si">%r</span><span class="s">&#39;</span>
								<span class="o">%</span> <span class="p">(</span><span class="n">idref</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="n">idref</span><span class="p">]))</span>
					<span class="n">nodes</span><span class="p">[</span><span class="n">idref</span><span class="p">][</span><span class="n">FUNC</span><span class="p">]</span> <span class="o">=</span> <span class="n">edge</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">)</span>
					<span class="n">nodes</span><span class="p">[</span><span class="n">idref</span><span class="p">][</span><span class="n">PARENT</span><span class="p">]</span> <span class="o">=</span> <span class="n">ntid</span>
				<span class="k">elif</span> <span class="n">edge</span><span class="o">.</span><span class="n">tag</span> <span class="o">==</span> <span class="s">&#39;secedge&#39;</span><span class="p">:</span>
					<span class="n">nodes</span><span class="p">[</span><span class="n">idref</span><span class="p">]</span><span class="o">.</span><span class="n">extend</span><span class="p">((</span><span class="n">edge</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;label&#39;</span><span class="p">),</span> <span class="n">ntid</span><span class="p">))</span>
				<span class="k">else</span><span class="p">:</span>
					<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&quot;expected &#39;edge&#39; or &#39;secedge&#39; tag.&quot;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">idref</span> <span class="ow">in</span> <span class="n">nodes</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">nodes</span><span class="p">[</span><span class="n">idref</span><span class="p">][</span><span class="n">PARENT</span><span class="p">]</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s"> does not have a parent: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
						<span class="n">idref</span><span class="p">,</span> <span class="n">nodes</span><span class="p">[</span><span class="n">idref</span><span class="p">]))</span>
		<span class="n">item</span> <span class="o">=</span> <span class="n">exporttree</span><span class="p">(</span>
				<span class="p">[</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">nodes</span><span class="o">.</span><span class="n">values</span><span class="p">()],</span>
				<span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lemmas</span><span class="p">)</span>
		<span class="n">item</span><span class="o">.</span><span class="n">tree</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">nodes</span><span class="p">[</span><span class="n">root</span><span class="p">][</span><span class="n">TAG</span><span class="p">]</span>
		<span class="n">item</span><span class="o">.</span><span class="n">block</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">item</span>

</div>
<div class="viewcode-block" id="AlpinoCorpusReader"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.AlpinoCorpusReader">[docs]</a><span class="k">class</span> <span class="nc">AlpinoCorpusReader</span><span class="p">(</span><span class="n">CorpusReader</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Corpus reader for the Dutch Alpino treebank in XML format.</span>

<span class="sd">	Expects a corpus in directory format, where every sentence is in a single</span>
<span class="sd">	``.xml`` file.&quot;&quot;&quot;</span>
<div class="viewcode-block" id="AlpinoCorpusReader.blocks"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.AlpinoCorpusReader.blocks">[docs]</a>	<span class="k">def</span> <span class="nf">blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">		:returns: a list of strings containing the raw representation of</span>
<span class="sd">			trees in the treebank.&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_cache</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="bp">self</span><span class="o">.</span><span class="n">_block_cache</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_read_blocks</span><span class="p">())</span>
		<span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_block_cache</span>
</div>
	<span class="k">def</span> <span class="nf">_read_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Read corpus and yield blocks corresponding to each sentence.&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;utf8&#39;</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Encoding specified in XML files, &#39;</span>
					<span class="s">&#39;cannot be overriden.&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">:</span>
			<span class="n">block</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s">&#39;rb&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>  <span class="c"># NB: store XML data as bytes</span>
			<span class="c"># ../path/dir/file.xml =&gt; dir/file</span>
			<span class="n">path</span><span class="p">,</span> <span class="n">filename</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
			<span class="n">_</span><span class="p">,</span> <span class="n">lastdir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>
			<span class="n">n</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">lastdir</span><span class="p">,</span> <span class="n">filename</span><span class="p">)[:</span><span class="o">-</span><span class="nb">len</span><span class="p">(</span><span class="s">&#39;.xml&#39;</span><span class="p">)]</span>
			<span class="k">yield</span> <span class="n">n</span><span class="p">,</span> <span class="n">block</span>

	<span class="k">def</span> <span class="nf">_parse</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">block</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;:returns: a parse tree given a string.&quot;&quot;&quot;</span>
		<span class="k">if</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">iselement</span><span class="p">(</span><span class="n">block</span><span class="p">):</span>
			<span class="n">xmlblock</span> <span class="o">=</span> <span class="n">block</span>
		<span class="k">else</span><span class="p">:</span>  <span class="c"># NB: parse because raw XML might contain entities etc.</span>
			<span class="n">xmlblock</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">block</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">alpinotree</span><span class="p">(</span>
				<span class="n">xmlblock</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">morphology</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">lemmas</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="DactCorpusReader"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.DactCorpusReader">[docs]</a><span class="k">class</span> <span class="nc">DactCorpusReader</span><span class="p">(</span><span class="n">AlpinoCorpusReader</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Corpus reader for Alpino trees in Dact format (DB XML).&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">_read_blocks</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
		<span class="kn">import</span> <span class="nn">alpinocorpus</span>
		<span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_encoding</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;utf8&#39;</span><span class="p">,</span> <span class="s">&#39;utf-8&#39;</span><span class="p">):</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;Encoding specified in XML files, &#39;</span>
					<span class="s">&#39;cannot be overriden.&#39;</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_filenames</span><span class="p">:</span>
			<span class="n">corpus</span> <span class="o">=</span> <span class="n">alpinocorpus</span><span class="o">.</span><span class="n">CorpusReader</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">corpus</span><span class="o">.</span><span class="n">entries</span><span class="p">():</span>
				<span class="k">yield</span> <span class="n">entry</span><span class="o">.</span><span class="n">name</span><span class="p">(),</span> <span class="n">entry</span><span class="o">.</span><span class="n">contents</span><span class="p">()</span>

</div>
<div class="viewcode-block" id="brackettree"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.brackettree">[docs]</a><span class="k">def</span> <span class="nf">brackettree</span><span class="p">(</span><span class="n">treestr</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">brackets</span><span class="p">,</span> <span class="n">strtermre</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Parse a single tree presented in (disc)bracket format.</span>

<span class="sd">	in the &#39;bracket&#39; case ``sent`` is ignored.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">strtermre</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">treestr</span><span class="p">):</span>  <span class="c"># terminals are not all indices</span>
		<span class="n">rest</span> <span class="o">=</span> <span class="n">sent</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
		<span class="n">sent</span><span class="p">,</span> <span class="n">cnt</span> <span class="o">=</span> <span class="p">[],</span> <span class="n">count</span><span class="p">()</span>

		<span class="k">def</span> <span class="nf">substleaf</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
			<span class="sd">&quot;&quot;&quot;Collect word and return index.&quot;&quot;&quot;</span>
			<span class="n">sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
			<span class="k">return</span> <span class="nb">next</span><span class="p">(</span><span class="n">cnt</span><span class="p">)</span>

		<span class="n">tree</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">FRONTIERNTRE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39; -FRONTIER-)&#39;</span><span class="p">,</span>
				<span class="n">SUPERFLUOUSSPACERE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="n">treestr</span><span class="p">)),</span>
				<span class="n">parse_leaf</span><span class="o">=</span><span class="n">substleaf</span><span class="p">,</span> <span class="n">brackets</span><span class="o">=</span><span class="n">brackets</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>  <span class="c"># disc. trees with integer indices as terminals</span>
		<span class="n">tree</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="o">.</span><span class="n">parse</span><span class="p">(</span><span class="n">treestr</span><span class="p">,</span> <span class="n">parse_leaf</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">brackets</span><span class="o">=</span><span class="n">brackets</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">sent</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
			<span class="n">maxleaf</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
			<span class="n">sent</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">sent</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n\r\t</span><span class="s">&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="n">maxleaf</span><span class="p">),</span> <span class="s">&#39;&#39;</span>
			<span class="n">sep</span> <span class="o">=</span> <span class="p">[</span><span class="n">sent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">b</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="s">&#39;</span><span class="se">\t\n\r</span><span class="s">&#39;</span> <span class="k">if</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">sent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
			<span class="k">if</span> <span class="n">sep</span><span class="p">:</span>
				<span class="n">sent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">rest</span> <span class="o">=</span> <span class="n">sent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][:</span><span class="nb">min</span><span class="p">(</span><span class="n">sep</span><span class="p">)],</span> <span class="n">sent</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">][</span><span class="nb">min</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">sent</span><span class="p">,</span> <span class="n">rest</span> <span class="o">=</span> <span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)),</span> <span class="s">&#39;&#39;</span>
	<span class="n">sent</span> <span class="o">=</span> <span class="p">[</span><span class="n">unquote</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">sent</span><span class="p">]</span>
	<span class="k">return</span> <span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">rest</span>

</div>
<div class="viewcode-block" id="exporttree"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.exporttree">[docs]</a><span class="k">def</span> <span class="nf">exporttree</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">functions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lemmas</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Get tree, sentence from tree in export format given as list of lines.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">getchildren</span><span class="p">(</span><span class="n">parent</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Traverse tree in export format and create Tree object.&quot;&quot;&quot;</span>
		<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="n">children</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="p">[]):</span>
			<span class="c"># n is the index in the block to record word indices</span>
			<span class="n">m</span> <span class="o">=</span> <span class="n">EXPORTNONTERMINAL</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">WORD</span><span class="p">])</span>
			<span class="k">if</span> <span class="n">m</span><span class="p">:</span>
				<span class="n">child</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">TAG</span><span class="p">],</span> <span class="n">getchildren</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">group</span><span class="p">(</span><span class="mi">1</span><span class="p">)))</span>
			<span class="k">else</span><span class="p">:</span>  <span class="c"># POS + terminal</span>
				<span class="n">child</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">TAG</span><span class="p">],</span> <span class="p">[</span><span class="n">n</span><span class="p">])</span>
				<span class="n">handlemorphology</span><span class="p">(</span><span class="n">morphology</span><span class="p">,</span> <span class="n">lemmas</span><span class="p">,</span> <span class="n">child</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">sent</span><span class="p">)</span>
			<span class="n">child</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
			<span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">child</span><span class="p">)</span>
		<span class="k">return</span> <span class="n">results</span>

	<span class="n">comment</span> <span class="o">=</span> <span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%%</span><span class="s">&#39;</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">if</span> <span class="s">&#39;</span><span class="si">%%</span><span class="s">&#39;</span> <span class="ow">in</span> <span class="n">block</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">else</span> <span class="bp">None</span>
	<span class="n">table</span> <span class="o">=</span> <span class="p">[</span><span class="n">exportsplit</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">block</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
	<span class="n">sent</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">table</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">EXPORTNONTERMINAL</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">WORD</span><span class="p">]):</span>
			<span class="k">break</span>
		<span class="n">sent</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">WORD</span><span class="p">])</span>
	<span class="n">children</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">source</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">table</span><span class="p">):</span>
		<span class="n">children</span><span class="o">.</span><span class="n">setdefault</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">PARENT</span><span class="p">],</span> <span class="p">[])</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">n</span><span class="p">,</span> <span class="n">source</span><span class="p">))</span>
	<span class="n">tree</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="p">(</span><span class="s">&#39;ROOT&#39;</span><span class="p">,</span> <span class="n">getchildren</span><span class="p">(</span><span class="s">&#39;0&#39;</span><span class="p">))</span>
	<span class="n">handlefunctions</span><span class="p">(</span><span class="n">functions</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="n">morphology</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">Item</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">block</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="exportsplit"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.exportsplit">[docs]</a><span class="k">def</span> <span class="nf">exportsplit</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Take a line in export format and split into fields.</span>

<span class="sd">	Add dummy fields lemma, sec. edge if those fields are absent.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="s">&quot;</span><span class="si">%%</span><span class="s">&quot;</span> <span class="ow">in</span> <span class="n">line</span><span class="p">:</span>  <span class="c"># we don&#39;t want comments.</span>
		<span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="p">[:</span><span class="n">line</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="s">&quot;</span><span class="si">%%</span><span class="s">&quot;</span><span class="p">)]</span>
	<span class="n">fields</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">()</span>
	<span class="n">fieldlen</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">fieldlen</span> <span class="o">&lt;</span> <span class="mi">5</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;expected at least 5 columns: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fields</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">fieldlen</span> <span class="o">&amp;</span> <span class="mi">1</span><span class="p">:</span>  <span class="c"># odd number of fields?</span>
		<span class="n">fields</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;--&#39;</span><span class="p">]</span>  <span class="c"># add empty lemma field</span>
	<span class="k">return</span> <span class="n">fields</span>

</div>
<div class="viewcode-block" id="alpinotree"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.alpinotree">[docs]</a><span class="k">def</span> <span class="nf">alpinotree</span><span class="p">(</span><span class="n">block</span><span class="p">,</span> <span class="n">functions</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">lemmas</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Get tree, sent from tree in Alpino format given as etree XML object.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">getsubtree</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">morphology</span><span class="p">,</span> <span class="n">lemmas</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Parse a subtree of an Alpino tree.&quot;&quot;&quot;</span>
		<span class="n">source</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">FIELDS</span><span class="p">)</span>
		<span class="n">source</span><span class="p">[</span><span class="n">WORD</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;word&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="s">&quot;#</span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">))</span>
		<span class="n">source</span><span class="p">[</span><span class="n">LEMMA</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;lemma&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;root&#39;</span><span class="p">)</span>
		<span class="n">source</span><span class="p">[</span><span class="n">MORPH</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;postag&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;frame&#39;</span><span class="p">)</span>
		<span class="n">source</span><span class="p">[</span><span class="n">FUNC</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;rel&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="s">&#39;cat&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="n">source</span><span class="p">[</span><span class="n">TAG</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cat&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">):</span>
				<span class="n">coindexed</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">source</span>
			<span class="n">label</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;cat&#39;</span><span class="p">)</span>
			<span class="n">result</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="p">(</span><span class="n">label</span><span class="o">.</span><span class="n">upper</span><span class="p">(),</span> <span class="p">[])</span>
			<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
				<span class="n">subtree</span> <span class="o">=</span> <span class="n">getsubtree</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">morphology</span><span class="p">,</span> <span class="n">lemmas</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">subtree</span> <span class="ow">and</span> <span class="p">(</span>
						<span class="s">&#39;word&#39;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span> <span class="ow">or</span> <span class="s">&#39;cat&#39;</span> <span class="ow">in</span> <span class="n">child</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
					<span class="n">subtree</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">PARENT</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">)</span>
					<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subtree</span><span class="p">)</span>
			<span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">result</span><span class="p">):</span>
				<span class="k">return</span> <span class="bp">None</span>
		<span class="k">elif</span> <span class="s">&#39;word&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="n">source</span><span class="p">[</span><span class="n">TAG</span><span class="p">]</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pt&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;pos&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">):</span>
				<span class="n">coindexed</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">)]</span> <span class="o">=</span> <span class="n">source</span>
			<span class="n">result</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">TAG</span><span class="p">],</span> <span class="nb">list</span><span class="p">(</span>
					<span class="nb">range</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;begin&#39;</span><span class="p">)),</span> <span class="nb">int</span><span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">)))))</span>
			<span class="n">handlemorphology</span><span class="p">(</span><span class="n">morphology</span><span class="p">,</span> <span class="n">lemmas</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">sent</span><span class="p">)</span>
		<span class="k">elif</span> <span class="s">&#39;index&#39;</span> <span class="ow">in</span> <span class="n">node</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
			<span class="n">coindexation</span><span class="p">[</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;index&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
					<span class="p">(</span><span class="n">node</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;rel&#39;</span><span class="p">),</span> <span class="n">parent</span><span class="p">))</span>
			<span class="k">return</span> <span class="bp">None</span>
		<span class="n">source</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">a</span> <span class="k">else</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">source</span><span class="p">]</span>
		<span class="n">result</span><span class="o">.</span><span class="n">source</span> <span class="o">=</span> <span class="n">source</span>
		<span class="k">return</span> <span class="n">result</span>

	<span class="n">coindexed</span> <span class="o">=</span> <span class="p">{}</span>
	<span class="n">coindexation</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">(</span><span class="nb">list</span><span class="p">)</span>
	<span class="n">sent</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;sentence&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
	<span class="n">tree</span> <span class="o">=</span> <span class="n">getsubtree</span><span class="p">(</span><span class="n">block</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;node&#39;</span><span class="p">),</span> <span class="bp">None</span><span class="p">,</span> <span class="n">morphology</span><span class="p">,</span> <span class="n">lemmas</span><span class="p">)</span>
	<span class="n">comment</span> <span class="o">=</span> <span class="n">block</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s">&#39;comments/comment&#39;</span><span class="p">)</span>  <span class="c"># NB: only use first comment</span>
	<span class="k">if</span> <span class="n">comment</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">comment</span> <span class="o">=</span> <span class="n">comment</span><span class="o">.</span><span class="n">text</span>
	<span class="n">handlefunctions</span><span class="p">(</span><span class="n">functions</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="n">morphology</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">Item</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">block</span><span class="p">))</span>

</div>
<div class="viewcode-block" id="writetree"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.writetree">[docs]</a><span class="k">def</span> <span class="nf">writetree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">fmt</span><span class="p">,</span> <span class="n">comment</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Convert a tree to a string representation in the given treebank format.</span>

<span class="sd">	:param tree: should have indices as terminals</span>
<span class="sd">	:param sent: contains the words corresponding to the indices in ``tree``</span>
<span class="sd">	:param n: an identifier for this tree; part of the output with some formats</span>
<span class="sd">	:param fmt: Formats are ``bracket``, ``discbracket``, Negra&#39;s ``export``</span>
<span class="sd">		format, and ``alpino`` XML format, as well unlabeled dependency</span>
<span class="sd">		conversion into ``mst`` or ``conll`` format (requires head rules).</span>
<span class="sd">		The formats ``tokens`` and ``wordpos`` are to strip away tree structure</span>
<span class="sd">		and leave only lines with tokens or ``token/POS``.</span>
<span class="sd">		When using ``bracket``, make sure tree is canonicalized.</span>
<span class="sd">	:param comment: optionally, a string that will go in the format&#39;s comment</span>
<span class="sd">		field (supported by ``export`` and ``alpino``), at the end of the line</span>
<span class="sd">		preceded by a tab (``discbracket``); ignored by other formats. Should</span>
<span class="sd">		be a single line.</span>

<span class="sd">	Lemmas, functions, and morphology information will be empty unless nodes</span>
<span class="sd">	contain a &#39;source&#39; attribute with such information.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;bracket&#39;</span><span class="p">:</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">writebrackettree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">)</span>
		<span class="c"># if comment:</span>
		<span class="c"># 	result = &#39;# %s\n%s\n&#39; % (comment, result.rstrip(&#39;\n&#39;))</span>
	<span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;discbracket&#39;</span><span class="p">:</span>
		<span class="n">result</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="n">quote</span><span class="p">,</span> <span class="n">sent</span><span class="p">)))</span>
		<span class="k">if</span> <span class="n">comment</span><span class="p">:</span>
			<span class="n">result</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">rstrip</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">),</span> <span class="n">comment</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;tokens&#39;</span><span class="p">:</span>
		<span class="n">result</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;wordpos&#39;</span><span class="p">:</span>
		<span class="n">result</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">word</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span> <span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">pos</span><span class="p">)</span>
				<span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sent</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">pos</span><span class="p">())))</span>
	<span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;export&#39;</span><span class="p">:</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">writeexporttree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">morphology</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;alpino&#39;</span><span class="p">:</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">writealpinotree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">comment</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">fmt</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;conll&#39;</span><span class="p">,</span> <span class="s">&#39;mst&#39;</span><span class="p">):</span>
		<span class="n">result</span> <span class="o">=</span> <span class="n">writedependencies</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">fmt</span><span class="p">)</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unrecognized format: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">fmt</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">result</span>

</div>
<div class="viewcode-block" id="writebrackettree"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.writebrackettree">[docs]</a><span class="k">def</span> <span class="nf">writebrackettree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Return a tree in bracket notation with words as terminals.&quot;&quot;&quot;</span>
	<span class="k">return</span> <span class="n">INDEXRE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="s">&#39; </span><span class="si">%s</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="n">quote</span><span class="p">(</span><span class="n">sent</span><span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">group</span><span class="p">()[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">])]),</span>
				<span class="s">&#39;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">tree</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="writeexporttree"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.writeexporttree">[docs]</a><span class="k">def</span> <span class="nf">writeexporttree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">comment</span><span class="p">,</span> <span class="n">morphology</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Return string with given tree in Negra&#39;s export format.&quot;&quot;&quot;</span>
	<span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">cmt</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39; </span><span class="si">%%</span><span class="s"> &#39;</span> <span class="o">+</span> <span class="n">comment</span><span class="p">)</span> <span class="k">if</span> <span class="n">comment</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
		<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;#BOS </span><span class="si">%s%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">cmt</span><span class="p">))</span>
	<span class="n">indices</span> <span class="o">=</span> <span class="n">tree</span><span class="o">.</span><span class="n">treepositions</span><span class="p">(</span><span class="s">&#39;leaves&#39;</span><span class="p">)</span>
	<span class="n">wordsandpreterminals</span> <span class="o">=</span> <span class="n">indices</span> <span class="o">+</span> <span class="p">[</span><span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">]</span>
	<span class="n">phrasalnodes</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">treepositions</span><span class="p">(</span><span class="s">&#39;postorder&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">a</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">wordsandpreterminals</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">!=</span> <span class="p">()]</span>
	<span class="n">wordids</span> <span class="o">=</span> <span class="p">{</span><span class="n">tree</span><span class="p">[</span><span class="n">a</span><span class="p">]:</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">}</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">indices</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">wordids</span><span class="p">):</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;sentence and terminals length mismatch:  &#39;</span>
				<span class="s">&#39;sentno: </span><span class="si">%s</span><span class="se">\n</span><span class="s">tree: </span><span class="si">%s</span><span class="se">\n</span><span class="s">sent (len=</span><span class="si">%d</span><span class="s">): </span><span class="si">%r</span><span class="se">\n</span><span class="s">leaves (len=</span><span class="si">%d</span><span class="s">): </span><span class="si">%r</span><span class="s">&#39;</span>
				<span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sent</span><span class="p">),</span> <span class="n">sent</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wordids</span><span class="p">),</span> <span class="n">wordids</span><span class="o">.</span><span class="n">keys</span><span class="p">()))</span>
	<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">word</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sent</span><span class="p">):</span>
		<span class="k">if</span> <span class="ow">not</span> <span class="n">word</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;empty word in sentence: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">sent</span><span class="p">)</span>
		<span class="n">idx</span> <span class="o">=</span> <span class="n">wordids</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
		<span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">idx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span>
		<span class="n">lemma</span> <span class="o">=</span> <span class="s">&#39;--&#39;</span>
		<span class="n">postag</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;$[&#39;</span><span class="p">,</span> <span class="s">&#39;$(&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span>
		<span class="n">func</span> <span class="o">=</span> <span class="n">morphtag</span> <span class="o">=</span> <span class="s">&#39;--&#39;</span>
		<span class="n">secedges</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s">&#39;source&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
			<span class="n">lemma</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">LEMMA</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span>
			<span class="n">morphtag</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">MORPH</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span>
			<span class="n">func</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">FUNC</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span>
			<span class="n">secedges</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span>
		<span class="k">if</span> <span class="n">morphtag</span> <span class="o">==</span> <span class="s">&#39;--&#39;</span> <span class="ow">and</span> <span class="n">morphology</span> <span class="o">==</span> <span class="s">&#39;replace&#39;</span><span class="p">:</span>
			<span class="n">morphtag</span> <span class="o">=</span> <span class="n">postag</span>
		<span class="k">elif</span> <span class="n">morphtag</span> <span class="o">==</span> <span class="s">&#39;--&#39;</span> <span class="ow">and</span> <span class="n">morphology</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span> <span class="ow">and</span> <span class="s">&#39;/&#39;</span> <span class="ow">in</span> <span class="n">postag</span><span class="p">:</span>
			<span class="n">postag</span><span class="p">,</span> <span class="n">morphtag</span> <span class="o">=</span> <span class="n">postag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">nodeid</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">500</span> <span class="o">+</span> <span class="n">phrasalnodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idx</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">2</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\t</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">word</span><span class="p">,</span> <span class="n">lemma</span><span class="p">,</span> <span class="n">postag</span><span class="p">,</span> <span class="n">morphtag</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>
				<span class="n">nodeid</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">secedges</span><span class="p">)))</span>
	<span class="k">for</span> <span class="n">idx</span> <span class="ow">in</span> <span class="n">phrasalnodes</span><span class="p">:</span>
		<span class="n">node</span> <span class="o">=</span> <span class="n">tree</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
		<span class="n">parent</span> <span class="o">=</span> <span class="s">&#39;#</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">500</span> <span class="o">+</span> <span class="n">phrasalnodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
		<span class="n">lemma</span> <span class="o">=</span> <span class="s">&#39;--&#39;</span>
		<span class="n">label</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">label</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span>
		<span class="n">func</span> <span class="o">=</span> <span class="n">morphtag</span> <span class="o">=</span> <span class="s">&#39;--&#39;</span>
		<span class="n">secedges</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="s">&#39;source&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
			<span class="n">morphtag</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">MORPH</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span>
			<span class="n">func</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">FUNC</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span>
			<span class="n">secedges</span> <span class="o">=</span> <span class="n">node</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="mi">6</span><span class="p">:]</span>
		<span class="n">nodeid</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%d</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="mi">500</span> <span class="o">+</span> <span class="n">phrasalnodes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">idx</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
				<span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">idx</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
		<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">parent</span><span class="p">,</span> <span class="n">lemma</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">morphtag</span><span class="p">,</span> <span class="n">func</span><span class="p">,</span>
				<span class="n">nodeid</span><span class="p">)</span> <span class="o">+</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">secedges</span><span class="p">)))</span>
	<span class="k">if</span> <span class="n">n</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
		<span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&quot;#EOS </span><span class="si">%s</span><span class="s">&quot;</span> <span class="o">%</span> <span class="n">n</span><span class="p">)</span>
	<span class="k">return</span> <span class="s">&quot;</span><span class="si">%s</span><span class="se">\n</span><span class="s">&quot;</span> <span class="o">%</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="writealpinotree"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.writealpinotree">[docs]</a><span class="k">def</span> <span class="nf">writealpinotree</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">commentstr</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Return XML string with tree in AlpinoXML format.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">addchildren</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">parent</span><span class="p">,</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">depth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">last</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Recursively add children of ``tree`` to XML object ``node``&quot;&quot;&quot;</span>
		<span class="n">node</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">parent</span><span class="p">,</span> <span class="s">&#39;node&#39;</span><span class="p">)</span>
		<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;id&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">next</span><span class="p">(</span><span class="n">cnt</span><span class="p">)))</span>
		<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;begin&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">())))</span>
		<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;end&#39;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="nb">max</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span> <span class="o">+</span> <span class="mi">1</span><span class="p">))</span>
		<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s">&#39;source&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
			<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;rel&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">FUNC</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span><span class="p">)</span>
		<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tree</span><span class="p">):</span>
			<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;cat&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
			<span class="n">node</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">  &#39;</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span> <span class="o">*</span> <span class="n">depth</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="nb">int</span><span class="p">)</span>
			<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;pos&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">lower</span><span class="p">())</span>
			<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;word&#39;</span><span class="p">,</span> <span class="n">sent</span><span class="p">[</span><span class="n">tree</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span>
			<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;lemma&#39;</span><span class="p">,</span> <span class="s">&#39;--&#39;</span><span class="p">)</span>
			<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;postag&#39;</span><span class="p">,</span> <span class="s">&#39;--&#39;</span><span class="p">)</span>
			<span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="s">&#39;source&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">):</span>
				<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;lemma&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">LEMMA</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span><span class="p">)</span>
				<span class="n">node</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;postag&#39;</span><span class="p">,</span> <span class="n">tree</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">MORPH</span><span class="p">]</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span><span class="p">)</span>
		<span class="n">node</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span> <span class="o">+</span> <span class="s">&#39;  &#39;</span> <span class="o">*</span> <span class="p">(</span><span class="n">depth</span> <span class="o">-</span> <span class="n">last</span><span class="p">)</span>
		<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">child</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
			<span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">Tree</span><span class="p">):</span>
				<span class="n">addchildren</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">node</span><span class="p">,</span> <span class="n">cnt</span><span class="p">,</span> <span class="n">depth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="n">x</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="p">))</span>

	<span class="n">result</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">Element</span><span class="p">(</span><span class="s">&#39;alpino_ds&#39;</span><span class="p">)</span>
	<span class="n">result</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="s">&#39;version&#39;</span><span class="p">,</span> <span class="s">&#39;1.3&#39;</span><span class="p">)</span>
	<span class="n">addchildren</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">count</span><span class="p">())</span>
	<span class="n">sentence</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">&#39;sentence&#39;</span><span class="p">)</span>
	<span class="n">sentence</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span>
	<span class="n">comment</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">SubElement</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="s">&#39;comment&#39;</span><span class="p">)</span>
	<span class="n">comment</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">|</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">commentstr</span><span class="p">))</span> <span class="k">if</span> <span class="n">commentstr</span> <span class="k">else</span> <span class="nb">str</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
	<span class="n">result</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="n">sentence</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">  &#39;</span>
	<span class="n">result</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="n">comment</span><span class="o">.</span><span class="n">tail</span> <span class="o">=</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span>
	<span class="k">return</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">tostring</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s">&#39;utf8&#39;</span><span class="p">)</span>  <span class="c"># hack</span>

</div>
<div class="viewcode-block" id="writedependencies"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.writedependencies">[docs]</a><span class="k">def</span> <span class="nf">writedependencies</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">fmt</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Convert tree to unlabeled dependencies in `mst` or `conll` format.&quot;&quot;&quot;</span>
	<span class="n">deps</span> <span class="o">=</span> <span class="n">dependencies</span><span class="p">(</span><span class="n">tree</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;mst&#39;</span><span class="p">:</span>  <span class="c"># MST parser can read this format</span>
		<span class="c"># fourth line with function tags is left empty.</span>
		<span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span>
			<span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">word</span> <span class="k">for</span> <span class="n">word</span> <span class="ow">in</span> <span class="n">sent</span><span class="p">),</span>
			<span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">tag</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">tag</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">pos</span><span class="p">())),</span>
			<span class="s">&#39;</span><span class="se">\t</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">head</span><span class="p">)</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">head</span> <span class="ow">in</span> <span class="n">deps</span><span class="p">)))</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span>
	<span class="k">elif</span> <span class="n">fmt</span> <span class="o">==</span> <span class="s">&#39;conll&#39;</span><span class="p">:</span>
		<span class="k">return</span> <span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%d</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="s">_</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="s">_</span><span class="se">\t</span><span class="si">%d</span><span class="se">\t</span><span class="si">%s</span><span class="se">\t</span><span class="s">_</span><span class="se">\t</span><span class="s">_&#39;</span> <span class="o">%</span> <span class="p">(</span>
			<span class="n">n</span><span class="p">,</span> <span class="n">word</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">tag</span><span class="p">,</span> <span class="n">head</span><span class="p">,</span> <span class="n">rel</span><span class="p">)</span>
			<span class="k">for</span> <span class="n">word</span><span class="p">,</span> <span class="p">(</span><span class="n">_</span><span class="p">,</span> <span class="n">tag</span><span class="p">),</span> <span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">rel</span><span class="p">,</span> <span class="n">head</span><span class="p">)</span>
			<span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">sent</span><span class="p">,</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">pos</span><span class="p">()),</span> <span class="n">deps</span><span class="p">))</span> <span class="o">+</span> <span class="s">&#39;</span><span class="se">\n\n</span><span class="s">&#39;</span>

</div>
<div class="viewcode-block" id="dependencies"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.dependencies">[docs]</a><span class="k">def</span> <span class="nf">dependencies</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Lin (1995): A Dependency-based Method for Evaluating [...] Parsers.&quot;&quot;&quot;</span>
	<span class="n">deps</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">deps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">makedep</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">deps</span><span class="p">),</span> <span class="s">&#39;ROOT&#39;</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
	<span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">deps</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">makedep</span><span class="p">(</span><span class="n">root</span><span class="p">,</span> <span class="n">deps</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Traverse a head-marked tree and extract dependencies.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tree</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">root</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span>
	<span class="n">headchild</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">root</span> <span class="k">if</span> <span class="n">ishead</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
	<span class="n">lexhead</span> <span class="o">=</span> <span class="n">makedep</span><span class="p">(</span><span class="n">headchild</span><span class="p">,</span> <span class="n">deps</span><span class="p">)</span>
	<span class="k">for</span> <span class="n">child</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">child</span> <span class="ow">is</span> <span class="n">headchild</span><span class="p">:</span>
			<span class="k">continue</span>
		<span class="n">lexheadofchild</span> <span class="o">=</span> <span class="n">makedep</span><span class="p">(</span><span class="n">child</span><span class="p">,</span> <span class="n">deps</span><span class="p">)</span>
		<span class="n">deps</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lexheadofchild</span><span class="p">,</span> <span class="s">&#39;NONE&#39;</span><span class="p">,</span> <span class="n">lexhead</span><span class="p">))</span>
	<span class="k">return</span> <span class="n">lexhead</span>


<div class="viewcode-block" id="handlefunctions"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.handlefunctions">[docs]</a><span class="k">def</span> <span class="nf">handlefunctions</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">tree</span><span class="p">,</span> <span class="n">pos</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Add function tags to phrasal labels e.g., &#39;VP&#39; =&gt; &#39;VP-HD&#39;.</span>

<span class="sd">	:param action: one of {None, &#39;add&#39;, &#39;replace&#39;, &#39;remove&#39;}</span>
<span class="sd">	:param pos: whether to add function tags to POS tags.</span>
<span class="sd">	:param top: whether to add function tags to the top node.</span>
<span class="sd">	:param morphology: if morphology=&#39;between&#39;, skip those nodes.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;leave&#39;</span><span class="p">):</span>
		<span class="k">return</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">subtrees</span><span class="p">():</span>
		<span class="k">if</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;remove&#39;</span><span class="p">:</span>
			<span class="k">for</span> <span class="n">char</span> <span class="ow">in</span> <span class="s">&#39;-=&#39;</span><span class="p">:</span>  <span class="c"># map NP-SUBJ and NP=2 to NP; don&#39;t touch -NONE-</span>
				<span class="n">x</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">char</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
					<span class="n">a</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">label</span><span class="p">[:</span><span class="n">x</span><span class="p">]</span>
		<span class="k">elif</span> <span class="n">morphology</span> <span class="o">==</span> <span class="s">&#39;between&#39;</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tree</span><span class="p">):</span>
			<span class="k">continue</span>
		<span class="k">elif</span> <span class="p">(</span><span class="ow">not</span> <span class="n">top</span> <span class="ow">or</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;between&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">a</span> <span class="ow">is</span> <span class="n">tree</span><span class="p">:</span>  <span class="c"># skip TOP label</span>
			<span class="k">continue</span>
		<span class="k">elif</span> <span class="n">pos</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">Tree</span><span class="p">):</span>
			<span class="c"># test for non-empty function tag (&#39;--&#39; is considered empty)</span>
			<span class="n">func</span> <span class="o">=</span> <span class="bp">None</span>
			<span class="k">if</span> <span class="p">(</span><span class="nb">getattr</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="s">&#39;source&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">)</span>
					<span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">FUNC</span><span class="p">]</span> <span class="ow">and</span> <span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">FUNC</span><span class="p">]</span> <span class="o">!=</span> <span class="s">&#39;--&#39;</span><span class="p">):</span>
				<span class="n">func</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">source</span><span class="p">[</span><span class="n">FUNC</span><span class="p">]</span>
			<span class="k">if</span> <span class="n">func</span> <span class="ow">and</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
				<span class="n">a</span><span class="o">.</span><span class="n">label</span> <span class="o">+=</span> <span class="s">&#39;-</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">func</span>
			<span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;replace&#39;</span><span class="p">:</span>
				<span class="n">a</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">func</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span>
			<span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;between&#39;</span><span class="p">:</span>
				<span class="n">parent</span><span class="p">,</span> <span class="n">idx</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">parent</span><span class="p">,</span> <span class="n">a</span><span class="o">.</span><span class="n">parent_index</span>
				<span class="n">newnode</span> <span class="o">=</span> <span class="n">ParentedTree</span><span class="p">(</span><span class="s">&#39;-&#39;</span> <span class="o">+</span> <span class="p">(</span><span class="n">func</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span><span class="p">),</span> <span class="p">[</span><span class="n">parent</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">idx</span><span class="p">)])</span>
				<span class="n">parent</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">newnode</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="handlemorphology"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.handlemorphology">[docs]</a><span class="k">def</span> <span class="nf">handlemorphology</span><span class="p">(</span><span class="n">action</span><span class="p">,</span> <span class="n">lemmaaction</span><span class="p">,</span> <span class="n">preterminal</span><span class="p">,</span> <span class="n">source</span><span class="p">,</span> <span class="n">sent</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Augment/replace preterminal label with morphological information.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="n">source</span><span class="p">:</span>
		<span class="k">return</span>
	<span class="c"># escape any parentheses to avoid hassles w/bracket notation of trees</span>
	<span class="n">tag</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">TAG</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">)</span>
	<span class="n">morph</span> <span class="o">=</span> <span class="n">source</span><span class="p">[</span><span class="n">MORPH</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span>
	<span class="n">lemma</span> <span class="o">=</span> <span class="p">(</span><span class="n">source</span><span class="p">[</span><span class="n">LEMMA</span><span class="p">]</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;[&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="s">&#39;]&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span>
			<span class="s">&#39; &#39;</span><span class="p">,</span> <span class="s">&#39;_&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="s">&#39;--&#39;</span><span class="p">)</span>
	<span class="k">if</span> <span class="n">lemmaaction</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">sent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;adding lemmas requires passing sent argument.&#39;</span><span class="p">)</span>
		<span class="n">sent</span><span class="p">[</span><span class="n">preterminal</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">+=</span> <span class="s">&#39;/&#39;</span> <span class="o">+</span> <span class="n">lemma</span>
	<span class="k">elif</span> <span class="n">lemmaaction</span> <span class="o">==</span> <span class="s">&#39;replace&#39;</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">sent</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;adding lemmas requires passing sent argument.&#39;</span><span class="p">)</span>
		<span class="n">sent</span><span class="p">[</span><span class="n">preterminal</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span> <span class="o">=</span> <span class="n">lemma</span>
	<span class="k">elif</span> <span class="n">lemmaaction</span> <span class="o">==</span> <span class="s">&#39;between&#39;</span><span class="p">:</span>
		<span class="n">preterminal</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">preterminal</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">lemma</span><span class="p">,</span> <span class="n">preterminal</span><span class="p">)]</span>
	<span class="k">elif</span> <span class="n">lemmaaction</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">):</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unrecognized action: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">lemmaaction</span><span class="p">)</span>

	<span class="k">if</span> <span class="n">action</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">):</span>
		<span class="n">preterminal</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">tag</span>
	<span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;add&#39;</span><span class="p">:</span>
		<span class="n">preterminal</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">/</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">tag</span><span class="p">,</span> <span class="n">morph</span><span class="p">)</span>
	<span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;replace&#39;</span><span class="p">:</span>
		<span class="n">preterminal</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">morph</span>
	<span class="k">elif</span> <span class="n">action</span> <span class="o">==</span> <span class="s">&#39;between&#39;</span><span class="p">:</span>
		<span class="n">preterminal</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">preterminal</span><span class="o">.</span><span class="n">__class__</span><span class="p">(</span><span class="n">morph</span><span class="p">,</span> <span class="p">[</span><span class="n">preterminal</span><span class="o">.</span><span class="n">pop</span><span class="p">()])]</span>
		<span class="n">preterminal</span><span class="o">.</span><span class="n">label</span> <span class="o">=</span> <span class="n">tag</span>
	<span class="k">elif</span> <span class="n">action</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;no&#39;</span><span class="p">):</span>
		<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unrecognized action: </span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="n">action</span><span class="p">)</span>
	<span class="k">return</span> <span class="n">preterminal</span>

</div>
<div class="viewcode-block" id="incrementaltreereader"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.incrementaltreereader">[docs]</a><span class="k">def</span> <span class="nf">incrementaltreereader</span><span class="p">(</span><span class="n">treeinput</span><span class="p">,</span> <span class="n">morphology</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">functions</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Incremental corpus reader.</span>

<span class="sd">	:param treeinput: an iterator giving one line at a time.</span>
<span class="sd">		Supports brackets, discbrackets, and export format. The format is</span>
<span class="sd">		autodetected.</span>
<span class="sd">	:yields: tuples ``(tree, sent, comment)`` with a Tree object, a separate</span>
<span class="sd">		lists of terminals, and a string with any other data following the</span>
<span class="sd">		tree.&quot;&quot;&quot;</span>
	<span class="n">treeinput</span> <span class="o">=</span> <span class="n">chain</span><span class="p">(</span><span class="nb">iter</span><span class="p">(</span><span class="n">treeinput</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">))</span>  <span class="c"># hack</span>
	<span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">treeinput</span><span class="p">)</span>
	<span class="c"># try the following readers on each line in this order</span>
	<span class="n">readers</span> <span class="o">=</span> <span class="p">[</span><span class="n">segmentexport</span><span class="p">(</span><span class="n">morphology</span><span class="p">,</span> <span class="n">functions</span><span class="p">),</span> <span class="n">segmentbrackets</span><span class="p">(</span><span class="s">&#39;()&#39;</span><span class="p">)]</span>
	<span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="n">readers</span><span class="p">:</span>
		<span class="n">reader</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="bp">None</span><span class="p">)</span>
	<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
		<span class="c"># status 0: line not part of tree; status 1: waiting for end of tree.</span>
		<span class="n">res</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">1</span>
		<span class="k">for</span> <span class="n">reader</span> <span class="ow">in</span> <span class="n">readers</span><span class="p">:</span>
			<span class="k">while</span> <span class="n">res</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
				<span class="n">res</span><span class="p">,</span> <span class="n">status</span> <span class="o">=</span> <span class="n">reader</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
				<span class="k">if</span> <span class="n">status</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
					<span class="k">break</span>  <span class="c"># there was no tree, or a complete tree was read</span>
				<span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">treeinput</span><span class="p">)</span>
			<span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
				<span class="k">for</span> <span class="n">tree</span> <span class="ow">in</span> <span class="n">res</span><span class="p">:</span>
					<span class="k">yield</span> <span class="n">tree</span>
				<span class="k">break</span>
		<span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>  <span class="c"># none of the readers accepted this line</span>
			<span class="n">line</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="n">treeinput</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="segmentbrackets"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.segmentbrackets">[docs]</a><span class="k">def</span> <span class="nf">segmentbrackets</span><span class="p">(</span><span class="n">brackets</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Co-routine that accepts one line at a time.</span>

<span class="sd">	Yields tuples (result, status) where ...</span>

<span class="sd">	- result is None or one or more S-expressions as a list of</span>
<span class="sd">		tuples (tree, rest), where rest is the string outside of brackets</span>
<span class="sd">		between this S-expression and the next.</span>
<span class="sd">	- status is 1 if the line was consumed, else 0.&quot;&quot;&quot;</span>
	<span class="k">def</span> <span class="nf">tryappend</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">rest</span><span class="p">):</span>
		<span class="sd">&quot;&quot;&quot;Add a tree to the results list.&quot;&quot;&quot;</span>
		<span class="k">try</span><span class="p">:</span>
			<span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">brackettree</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">rest</span><span class="p">,</span> <span class="n">brackets</span><span class="p">,</span> <span class="n">strtermre</span><span class="p">))</span>
		<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
			<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%r</span><span class="se">\n</span><span class="s">while parsing:</span><span class="se">\n</span><span class="si">%r</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span>
					<span class="n">err</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="n">result</span><span class="o">=</span><span class="n">result</span><span class="p">,</span> <span class="n">rest</span><span class="o">=</span><span class="n">rest</span><span class="p">,</span> <span class="n">parens</span><span class="o">=</span><span class="n">parens</span><span class="p">,</span>
						<span class="n">depth</span><span class="o">=</span><span class="n">depth</span><span class="p">,</span> <span class="n">prev</span><span class="o">=</span><span class="n">prev</span><span class="p">)))</span>
	<span class="n">lb</span><span class="p">,</span> <span class="n">rb</span> <span class="o">=</span> <span class="n">brackets</span>
	<span class="c"># regex to check if the tree contains any terminals (as opposed to indices)</span>
	<span class="n">strtermre</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39; (?:[^ </span><span class="si">%(br)s</span><span class="s">]*[^ 0-9</span><span class="si">%(br)s</span><span class="s">][^ </span><span class="si">%(br)s</span><span class="s">]*)?</span><span class="si">%(rb)s</span><span class="s">&#39;</span> <span class="o">%</span>
			<span class="nb">dict</span><span class="p">(</span><span class="n">br</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">brackets</span><span class="p">),</span> <span class="n">rb</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">escape</span><span class="p">(</span><span class="n">rb</span><span class="p">)))</span>
	<span class="n">newlb</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;(?:.*[\n\r])?\s*&#39;</span><span class="p">)</span>
	<span class="n">parens</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># number of open parens</span>
	<span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># max. number of open parens</span>
	<span class="n">prev</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>  <span class="c"># incomplete tree currently being read</span>
	<span class="n">result</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>  <span class="c"># string of complete tree</span>
	<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>  <span class="c"># trees found in current line</span>
	<span class="n">rest</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>  <span class="c"># any non-tree data after a tree</span>
	<span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
		<span class="n">start</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c"># index where current tree starts</span>
		<span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev</span><span class="p">)),</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">prev</span><span class="p">))</span>
		<span class="c"># ignore first left bracket when not preceded by whitespace</span>
		<span class="k">if</span> <span class="n">parens</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">a</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">newlb</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">prev</span><span class="p">)</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="n">a</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
		<span class="n">prev</span> <span class="o">=</span> <span class="n">line</span>
		<span class="k">while</span> <span class="n">a</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="n">b</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">a</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">a</span> <span class="o">&lt;</span> <span class="n">b</span> <span class="ow">or</span> <span class="n">b</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>  <span class="c"># left bracket</span>
				<span class="c"># look ahead to see whether this will be a tree with depth &gt; 1</span>
				<span class="k">if</span> <span class="n">parens</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">or</span> <span class="mi">0</span> <span class="o">&lt;=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">b</span><span class="p">):</span>
					<span class="n">rest</span><span class="p">,</span> <span class="n">prev</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">a</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="n">a</span><span class="p">:]</span>
					<span class="k">if</span> <span class="n">result</span><span class="p">:</span>
						<span class="n">tryappend</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
						<span class="n">result</span><span class="p">,</span> <span class="n">start</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="p">,</span> <span class="n">a</span>
				<span class="n">parens</span> <span class="o">+=</span> <span class="mi">1</span>
				<span class="n">depth</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">parens</span><span class="p">)</span>
				<span class="n">a</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">lb</span><span class="p">,</span> <span class="n">a</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
			<span class="k">elif</span> <span class="n">b</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span> <span class="ow">and</span> <span class="p">(</span><span class="n">b</span> <span class="o">&lt;</span> <span class="n">a</span> <span class="ow">or</span> <span class="n">a</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>  <span class="c"># right bracket</span>
				<span class="n">parens</span> <span class="o">-=</span> <span class="mi">1</span>
				<span class="k">if</span> <span class="n">parens</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">depth</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
					<span class="n">result</span><span class="p">,</span> <span class="n">prev</span> <span class="o">=</span> <span class="n">line</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">],</span> <span class="n">line</span><span class="p">[</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">:]</span>
					<span class="n">start</span> <span class="o">=</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span>
					<span class="n">depth</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="k">elif</span> <span class="n">parens</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
					<span class="k">if</span> <span class="n">strict</span><span class="p">:</span>
						<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;unbalanced parentheses&#39;</span><span class="p">)</span>
					<span class="n">parens</span> <span class="o">=</span> <span class="mi">0</span>
				<span class="n">b</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">rb</span><span class="p">,</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
		<span class="n">status</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">or</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">parens</span> <span class="k">else</span> <span class="mi">0</span>
		<span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="n">results</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">,</span> <span class="n">status</span><span class="p">)</span>
		<span class="k">if</span> <span class="n">results</span><span class="p">:</span>
			<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="n">line</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
			<span class="k">if</span> <span class="n">result</span><span class="p">:</span>
				<span class="n">tryappend</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">rest</span><span class="p">)</span>
			<span class="n">status</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">results</span> <span class="ow">or</span> <span class="n">result</span> <span class="ow">or</span> <span class="n">parens</span> <span class="k">else</span> <span class="mi">0</span>
			<span class="k">yield</span> <span class="n">results</span> <span class="ow">or</span> <span class="bp">None</span><span class="p">,</span> <span class="n">status</span>
			<span class="n">line</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>
			<span class="k">if</span> <span class="n">results</span><span class="p">:</span>
				<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">if</span> <span class="n">parens</span> <span class="ow">or</span> <span class="n">result</span><span class="p">:</span>
			<span class="n">line</span> <span class="o">=</span> <span class="n">prev</span> <span class="o">+</span> <span class="n">line</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">prev</span> <span class="o">=</span> <span class="s">&#39;&#39;</span>

</div>
<div class="viewcode-block" id="segmentexport"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.segmentexport">[docs]</a><span class="k">def</span> <span class="nf">segmentexport</span><span class="p">(</span><span class="n">morphology</span><span class="p">,</span> <span class="n">functions</span><span class="p">,</span> <span class="n">strict</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Co-routine that accepts one line at a time.</span>
<span class="sd">	Yields tuples ``(result, status)`` where ...</span>

<span class="sd">	- result is ``None`` or a segment delimited by</span>
<span class="sd">		``#BOS`` and ``#EOS`` as a list of lines;</span>
<span class="sd">	- status is 1 if the line was consumed, else 0.&quot;&quot;&quot;</span>
	<span class="n">cur</span> <span class="o">=</span> <span class="p">[]</span>
	<span class="n">inblock</span> <span class="o">=</span> <span class="mi">0</span>
	<span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
	<span class="k">while</span> <span class="n">line</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
		<span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#BOS &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#BOT &#39;</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">strict</span> <span class="ow">and</span> <span class="n">inblock</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;nested #BOS or #BOT&#39;</span><span class="p">)</span>
			<span class="n">cur</span> <span class="o">=</span> <span class="p">[</span><span class="n">line</span><span class="p">]</span>
			<span class="n">inblock</span> <span class="o">=</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#BOS &#39;</span><span class="p">)</span> <span class="k">else</span> <span class="mi">2</span>
			<span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
		<span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#EOS &#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#EOT &#39;</span><span class="p">):</span>
			<span class="k">if</span> <span class="n">strict</span> <span class="ow">and</span> <span class="n">inblock</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
				<span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s">&#39;#EOS or #EOT without start tag&#39;</span><span class="p">)</span>
			<span class="n">cur</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
			<span class="n">item</span> <span class="o">=</span> <span class="n">exporttree</span><span class="p">(</span><span class="n">cur</span><span class="p">,</span> <span class="n">functions</span><span class="p">,</span> <span class="n">morphology</span><span class="p">)</span>
			<span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="p">((</span><span class="n">item</span><span class="o">.</span><span class="n">tree</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">sent</span><span class="p">,</span> <span class="n">item</span><span class="o">.</span><span class="n">comment</span><span class="p">),</span> <span class="p">),</span> <span class="mi">1</span><span class="p">)</span>
			<span class="n">inblock</span> <span class="o">=</span> <span class="mi">0</span>
			<span class="n">cur</span> <span class="o">=</span> <span class="p">[]</span>
		<span class="k">elif</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">():</span>
			<span class="k">if</span> <span class="n">inblock</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
				<span class="n">cur</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line</span><span class="p">)</span>
			<span class="n">line</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">lstrip</span><span class="p">()</span>
			<span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="bp">None</span><span class="p">,</span> <span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">inblock</span>
					<span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%%</span><span class="s">&#39;</span><span class="p">)</span>
					<span class="ow">or</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;#FORMAT &#39;</span><span class="p">)</span>
				<span class="k">else</span> <span class="mi">0</span><span class="p">))</span>
		<span class="k">else</span><span class="p">:</span>
			<span class="n">line</span> <span class="o">=</span> <span class="p">(</span><span class="k">yield</span> <span class="bp">None</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="quote"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.quote">[docs]</a><span class="k">def</span> <span class="nf">quote</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Quote parentheses and replace None with &#39;&#39;.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">word</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
		<span class="k">return</span> <span class="s">&#39;&#39;</span>
	<span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;(&#39;</span><span class="p">,</span> <span class="s">&#39;-LRB-&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="s">&#39;-RRB-&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="unquote"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.unquote">[docs]</a><span class="k">def</span> <span class="nf">unquote</span><span class="p">(</span><span class="n">word</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Reverse quoting of parentheses, frontier spans.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">word</span> <span class="ow">in</span> <span class="p">(</span><span class="s">&#39;&#39;</span><span class="p">,</span> <span class="s">&#39;-FRONTIER-&#39;</span><span class="p">):</span>
		<span class="k">return</span> <span class="bp">None</span>
	<span class="k">return</span> <span class="n">word</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-LRB-&#39;</span><span class="p">,</span> <span class="s">&#39;(&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s">&#39;-RRB-&#39;</span><span class="p">,</span> <span class="s">&#39;)&#39;</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="termindices"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.termindices">[docs]</a><span class="k">def</span> <span class="nf">termindices</span><span class="p">(</span><span class="n">treestr</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Replace terminals in a tree string with consecutive indices.</span>

<span class="sd">	Only applicable to phrase-structure trees without discontinuity.</span>

<span class="sd">	:returns: tuple ``(tree, sent)`` with Tree object and sentence as list of</span>
<span class="sd">		strings.</span>

<span class="sd">	&gt;&gt;&gt; tree, sent = termindices(&#39;(S (NP Mary) (VP walks))&#39;)</span>
<span class="sd">	&gt;&gt;&gt; print(tree)</span>
<span class="sd">	(S (NP 0) (VP 1))</span>
<span class="sd">	&gt;&gt;&gt; print(&#39; &#39;.join(sent))</span>
<span class="sd">	Mary walks&quot;&quot;&quot;</span>
	<span class="n">cnt</span> <span class="o">=</span> <span class="n">count</span><span class="p">()</span>
	<span class="n">treestr</span> <span class="o">=</span> <span class="n">SUPERFLUOUSSPACERE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="s">&#39;)&#39;</span><span class="p">,</span> <span class="n">treestr</span><span class="p">)</span>
	<span class="n">tree</span> <span class="o">=</span> <span class="n">LEAVESRE</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="k">lambda</span> <span class="n">_</span><span class="p">:</span> <span class="s">&#39; </span><span class="si">%d</span><span class="s">)&#39;</span> <span class="o">%</span> <span class="nb">next</span><span class="p">(</span><span class="n">cnt</span><span class="p">),</span> <span class="n">treestr</span><span class="p">)</span>
	<span class="n">sent</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="ow">or</span> <span class="bp">None</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">LEAVESRE</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">treestr</span><span class="p">)]</span>
	<span class="k">return</span> <span class="n">tree</span><span class="p">,</span> <span class="n">sent</span>

</div>
<div class="viewcode-block" id="numbase"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.numbase">[docs]</a><span class="k">def</span> <span class="nf">numbase</span><span class="p">(</span><span class="n">key</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Split file name in numeric and string components to use as sort key.&quot;&quot;&quot;</span>
	<span class="n">path</span><span class="p">,</span> <span class="n">base</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>
	<span class="n">components</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">r&#39;[-.,_ ]&#39;</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">splitext</span><span class="p">(</span><span class="n">base</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span>
	<span class="n">components</span> <span class="o">=</span> <span class="p">[</span><span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="s">r&#39;[0-9]+&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span> <span class="k">else</span> <span class="n">a</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">components</span><span class="p">]</span>
	<span class="k">return</span> <span class="p">[</span><span class="n">path</span><span class="p">]</span> <span class="o">+</span> <span class="n">components</span>

</div>
<div class="viewcode-block" id="removeterminals"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.removeterminals">[docs]</a><span class="k">def</span> <span class="nf">removeterminals</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="n">func</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Remove any terminals for which func is True, and any empty ancestors.&quot;&quot;&quot;</span>
	<span class="n">delete</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">reversed</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">treepositions</span><span class="p">(</span><span class="s">&#39;leaves&#39;</span><span class="p">)):</span>
		<span class="k">if</span> <span class="n">func</span><span class="p">(</span><span class="n">sent</span><span class="p">[</span><span class="n">tree</span><span class="p">[</span><span class="n">a</span><span class="p">]],</span> <span class="n">tree</span><span class="p">[</span><span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]]</span><span class="o">.</span><span class="n">label</span><span class="p">):</span>
			<span class="n">delete</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">tree</span><span class="p">[</span><span class="n">a</span><span class="p">])</span>
			<span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)):</span>
				<span class="k">del</span> <span class="n">tree</span><span class="p">[</span><span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="n">n</span><span class="p">]]</span>
				<span class="k">if</span> <span class="n">tree</span><span class="p">[</span><span class="n">a</span><span class="p">[:</span><span class="o">-</span><span class="p">(</span><span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)]]:</span>
					<span class="k">break</span>
	<span class="c"># renumber</span>
	<span class="n">oldleaves</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span>
	<span class="n">newleaves</span> <span class="o">=</span> <span class="p">{</span><span class="n">a</span><span class="p">:</span> <span class="n">n</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">oldleaves</span><span class="p">)}</span>
	<span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">tree</span><span class="o">.</span><span class="n">treepositions</span><span class="p">(</span><span class="s">&#39;leaves&#39;</span><span class="p">):</span>
		<span class="n">tree</span><span class="p">[</span><span class="n">a</span><span class="p">]</span> <span class="o">=</span> <span class="n">newleaves</span><span class="p">[</span><span class="n">tree</span><span class="p">[</span><span class="n">a</span><span class="p">]]</span>
	<span class="n">sent</span><span class="p">[:]</span> <span class="o">=</span> <span class="p">[</span><span class="n">a</span> <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">a</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sent</span><span class="p">)</span> <span class="k">if</span> <span class="n">n</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">delete</span><span class="p">]</span>
	<span class="k">assert</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">())</span> <span class="o">==</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tree</span><span class="o">.</span><span class="n">leaves</span><span class="p">()))),</span> <span class="n">tree</span>

</div>
<div class="viewcode-block" id="removeemptynodes"><a class="viewcode-back" href="../../api/discodop.treebank.html#discodop.treebank.removeemptynodes">[docs]</a><span class="k">def</span> <span class="nf">removeemptynodes</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Remove any empty nodes, and any empty ancestors.&quot;&quot;&quot;</span>
	<span class="n">removeterminals</span><span class="p">(</span><span class="n">tree</span><span class="p">,</span> <span class="n">sent</span><span class="p">,</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">&#39;&#39;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">y</span> <span class="o">==</span> <span class="s">&#39;-NONE-&#39;</span><span class="p">)</span>

</div>
<span class="k">def</span> <span class="nf">openread</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s">&#39;utf8&#39;</span><span class="p">):</span>
	<span class="sd">&quot;&quot;&quot;Open text file for reading; decompress .gz files on-the-fly.&quot;&quot;&quot;</span>
	<span class="k">if</span> <span class="n">filename</span> <span class="o">==</span> <span class="s">&#39;-&#39;</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">stdin</span><span class="o">.</span><span class="n">fileno</span><span class="p">(),</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>
	<span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="ow">and</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s">&#39;.gz&#39;</span><span class="p">):</span>
		<span class="k">return</span> <span class="n">codecs</span><span class="o">.</span><span class="n">getreader</span><span class="p">(</span><span class="n">encoding</span><span class="p">)(</span><span class="n">gzip</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>
	<span class="k">else</span><span class="p">:</span>
		<span class="k">return</span> <span class="n">io</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="n">encoding</span><span class="p">)</span>


<span class="n">READERS</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">(((</span><span class="s">&#39;export&#39;</span><span class="p">,</span> <span class="n">NegraCorpusReader</span><span class="p">),</span>
		<span class="p">(</span><span class="s">&#39;bracket&#39;</span><span class="p">,</span> <span class="n">BracketCorpusReader</span><span class="p">),</span>
		<span class="p">(</span><span class="s">&#39;discbracket&#39;</span><span class="p">,</span> <span class="n">DiscBracketCorpusReader</span><span class="p">),</span>
		<span class="p">(</span><span class="s">&#39;tiger&#39;</span><span class="p">,</span> <span class="n">TigerXMLCorpusReader</span><span class="p">),</span>
		<span class="p">(</span><span class="s">&#39;alpino&#39;</span><span class="p">,</span> <span class="n">AlpinoCorpusReader</span><span class="p">),</span> <span class="p">(</span><span class="s">&#39;dact&#39;</span><span class="p">,</span> <span class="n">DactCorpusReader</span><span class="p">)))</span>
<span class="n">WRITERS</span> <span class="o">=</span> <span class="p">(</span><span class="s">&#39;export&#39;</span><span class="p">,</span> <span class="s">&#39;bracket&#39;</span><span class="p">,</span> <span class="s">&#39;discbracket&#39;</span><span class="p">,</span> <span class="s">&#39;dact&#39;</span><span class="p">,</span>
		<span class="s">&#39;conll&#39;</span><span class="p">,</span> <span class="s">&#39;mst&#39;</span><span class="p">,</span> <span class="s">&#39;tokens&#39;</span><span class="p">,</span> <span class="s">&#39;wordpos&#39;</span><span class="p">)</span>

<span class="n">__all__</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;Item&#39;</span><span class="p">,</span> <span class="s">&#39;CorpusReader&#39;</span><span class="p">,</span> <span class="s">&#39;BracketCorpusReader&#39;</span><span class="p">,</span>
		<span class="s">&#39;DiscBracketCorpusReader&#39;</span><span class="p">,</span> <span class="s">&#39;NegraCorpusReader&#39;</span><span class="p">,</span> <span class="s">&#39;AlpinoCorpusReader&#39;</span><span class="p">,</span>
		<span class="s">&#39;TigerXMLCorpusReader&#39;</span><span class="p">,</span> <span class="s">&#39;DactCorpusReader&#39;</span><span class="p">,</span> <span class="s">&#39;brackettree&#39;</span><span class="p">,</span>
		<span class="s">&#39;exporttree&#39;</span><span class="p">,</span> <span class="s">&#39;exportsplit&#39;</span><span class="p">,</span> <span class="s">&#39;alpinotree&#39;</span><span class="p">,</span> <span class="s">&#39;writetree&#39;</span><span class="p">,</span>
		<span class="s">&#39;writebrackettree&#39;</span><span class="p">,</span> <span class="s">&#39;writeexporttree&#39;</span><span class="p">,</span> <span class="s">&#39;writealpinotree&#39;</span><span class="p">,</span>
		<span class="s">&#39;writedependencies&#39;</span><span class="p">,</span> <span class="s">&#39;dependencies&#39;</span><span class="p">,</span> <span class="s">&#39;handlefunctions&#39;</span><span class="p">,</span>
		<span class="s">&#39;handlemorphology&#39;</span><span class="p">,</span> <span class="s">&#39;incrementaltreereader&#39;</span><span class="p">,</span> <span class="s">&#39;segmentbrackets&#39;</span><span class="p">,</span>
		<span class="s">&#39;segmentexport&#39;</span><span class="p">,</span> <span class="s">&#39;quote&#39;</span><span class="p">,</span> <span class="s">&#39;unquote&#39;</span><span class="p">,</span> <span class="s">&#39;termindices&#39;</span><span class="p">,</span> <span class="s">&#39;numbase&#39;</span><span class="p">,</span>
		<span class="s">&#39;removeterminals&#39;</span><span class="p">,</span> <span class="s">&#39;removeemptynodes&#39;</span><span class="p">]</span>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../../index.html">Table Of Contents</a></h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html">Getting started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../intro.html#overview">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../ref.html">Reference</a></li>
</ul>

<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="nav-item nav-item-0"><a href="../../index.html">Disco-DOP 0.5pre1 documentation</a> &raquo;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
        &copy; Copyright 2015, Andreas van Cranenburgh.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.3.1.
    </div>
  </body>
</html>